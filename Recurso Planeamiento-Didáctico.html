<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantilla de Planeamiento Did√°ctico - PNFT</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #45258F;
            --secondary-color: #6c47c9;
            --light-purple: #f0ebf9;
            --border-color: #dee2e6;
            --text-color: #333;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f8f9fa;
            padding: 20px;
            line-height: 1.5;
            color: var(--text-color);
            font-size: 14px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 4px solid var(--primary-color);
            padding-bottom: 15px;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header h2 {
            color: var(--secondary-color);
            font-size: 18px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .input-field, .select-field, .textarea-field {
            width: 100%;
            border: 2px solid var(--border-color);
            outline: none;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Poppins', sans-serif;
        }

        .input-field:focus, .select-field:focus, .textarea-field:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(69, 37, 143, 0.1);
        }

        .section-title {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
            text-align: center;
            padding: 12px;
            margin: 15px 0 10px 0;
            border-radius: 8px;
            font-size: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        td {
            border: 1px solid var(--border-color);
            padding: 10px;
            vertical-align: top;
        }

        .ejes-transversales {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }

        .eje-option {
            padding: 12px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .eje-option:hover {
            border-color: var(--primary-color);
        }

        .eje-option.selected {
            border-color: var(--primary-color);
            background: var(--light-purple);
        }

        .semanas-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 12px;
            background: var(--light-purple);
            border-radius: 8px;
            border: 2px dashed var(--primary-color);
        }

        .btn-agregar-semana {
            background: linear-gradient(135deg, var(--success-color), #218838);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-agregar-semana:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .semana-item {
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 4px; /* CAMBIO CR√çTICO: Era 20px, ahora 4px */
            background: white;
        }

        .semana-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .semana-header strong {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 14px;
        }

        .semana-nombre {
            width: 180px !important;
            font-weight: 500;
        }

        .btn-eliminar-semana {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .areas-rda-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .areas-container, .rda-container {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .areas-lista {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .area-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .area-item:hover {
            background: var(--light-purple);
        }

        .rda-item {
            padding: 8px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.6;
        }

        .saberes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .saber-columna {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: visible;
        }

        .saber-titulo {
            background: var(--primary-color);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .saber-contenido {
            padding: 12px;
            min-height: 180px;
            background: white;
            overflow: visible !important;
            font-size: 13px;
        }

        .tooltip-improved {
            position: relative;
            display: inline-block;
            cursor: help;
            z-index: 1000;
        }

        .tooltip-improved .tooltiptext-improved {
            visibility: hidden;
            width: 350px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.3;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            bottom: 125%;
            left: 150;
            transform: translateX(-50%);
            max-height: none;
            overflow: visible;
            white-space: normal;
            word-wrap: break-word;
        }

        .tooltip-improved .tooltiptext-improved::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip-improved:hover .tooltiptext-improved {
            visibility: visible;
            opacity: 1;
        }

        .saberes-conceptuales-container {
            margin: 15px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            font-size: 14px;
        }

        .saber-conceptual-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 8px;
            margin: 4px 0;
            background: white;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .saber-conceptual-item:hover {
            background: var(--light-purple);
        }

        .saber-conceptual-item.seleccionado {
            background: var(--light-purple);
            border-left: 3px solid var(--primary-color);
        }

        .indicador-logro {
            font-size: 11px;
            color: #666;
            margin-left: 20px;
            margin-top: 3px;
            line-height: 1.3;
        }

        .tres-columnas {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .campo-editable {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }

        .columna-titulo {
            background: var(--secondary-color);
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
        }

        .contenedor-editable {
            min-height: 120px;
            padding: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 12px;
            line-height: 1.4;
            background: white;
            resize: vertical;
            outline: none;
        }

        .contenedor-editable[contenteditable="true"]:empty:before {
            content: attr(data-placeholder);
            color: #999;
            font-style: italic;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 2px solid var(--light-purple);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            position: relative;
        }

        .export-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .export-option {
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-option:hover {
            border-color: var(--primary-color);
        }

        .export-option.selected {
            border-color: var(--primary-color);
            background: var(--light-purple);
        }

        .checkbox-group {
            margin: 12px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .checkbox-item {
            margin: 6px 0;
        }

        .file-save-info {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 8px;
            margin: 8px 0;
            font-size: 11px;
        }

        .info-note {
            background: #e7f3ff;
            border-left: 3px solid #007bff;
            padding: 8px;
            margin: 8px 0;
            border-radius: 4px;
            font-size: 11px;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
            color: var(--primary-color);
            padding: 15px;
            border-top: 2px solid var(--primary-color);
            background: var(--light-purple);
            border-radius: 8px;
        }

        .semestre-container {
            display: flex;
            gap: 10px;
            margin-top: 6px;
        }

        .semestre-container > div {
            flex: 1;
        }

        .semestre-container .select-field {
            width: 100% !important;
            min-width: 110px;
        }

        @media print {
            .action-buttons, .btn-agregar-semana, .btn-eliminar-semana,
            .modal, .semanas-controls, .btn {
                display: none !important;
            }
            
            .indicador-logro, .area-item small, .rda-item, 
            .saber-conceptual-item, .contenedor-editable {
                color: #000000 !important;
            }
            
            .section-title {
                color: #000000 !important;
                background: #f0f0f0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }

        .espacio-optimizado {
            margin-top: 8px;
            margin-bottom: 8px;
        }

        .textarea-field {
            width: 100%;
            border: 2px solid var(--border-color);
            outline: none;
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            background: white;
            font-family: 'Poppins', sans-serif;
            resize: vertical;
            max-width: 100%;
            box-sizing: border-box;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- ENCABEZADO -->
        <div class="header">
            <h1>Plantilla de Planeamiento Did√°ctico</h1>
            <h2>Programa Nacional de Formaci√≥n Tecnol√≥gica - Inform√°tica educativa</h2>
        </div>

        <!-- INFORMACI√ìN GENERAL -->
        <table>
            <tr>
                <td width="33%">
                    <strong>Direcci√≥n Regional de Educaci√≥n:</strong><br>
                    <input type="text" id="direccionRegional" class="input-field" placeholder="Ingrese la direcci√≥n regional">
                </td>
                <td width="33%">
                    <strong>Centro educativo:</strong><br>
                    <input type="text" id="centroEducativo" class="input-field" placeholder="Nombre del centro educativo">
                </td>
                <td width="34%">
                    <div style="display: flex; gap: 6px;">
                        <div style="flex: 1">
                            <strong>C√≥digo presupuestario:</strong><br>
                            <input type="text" id="codigoCentro" class="input-field" placeholder="C√≥digo">
                        </div>
                        <div style="flex: 1">
                            <strong>Circuito:</strong><br>
                            <input type="text" id="circuito" class="input-field" placeholder="Circuito">
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <strong>Nombre de la persona docente:</strong><br>
                    <input type="text" id="nombreDocente" class="input-field" placeholder="Su nombre completo">
                </td>
                <td colspan="2">
                    <strong>Asignatura:</strong><br>
                    <input type="text" id="asignatura" class="input-field" value="Formaci√≥n tecnol√≥gica/Inform√°tica Educativa" readonly style="background: #f0f0f0;">
                    <div class="semestre-container">
                        <div>
                            <strong>Curso lectivo:</strong><br>
                            <select id="cursoLectivo" class="select-field">
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                            </select>
                        </div>
                        <div>
                            <strong>Semestre:</strong><br>
                            <select id="semestre" class="select-field">
                                <option value="I">I Semestre</option>
                                <option value="II">II Semestre</option>
                            </select>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <strong>Ciclo:</strong><br>
                    <select id="ciclo" class="select-field" onchange="actualizarNiveles()">
                        <option value="">Seleccionar</option>
                        <option value="Materno Infantil/Transici√≥n">Materno Infantil/Transici√≥n</option>
                        <option value="I Ciclo">I Ciclo</option>
                        <option value="II Ciclo">II Ciclo</option>
                        <option value="III Ciclo">III Ciclo</option>
                    </select>
                </td>
                <td>
                    <strong>Nivel:</strong><br>
                    <select id="nivel" class="select-field">
                        <option value="">Seleccione primero el ciclo</option>
                    </select>
                </td>
                <td>
                    <strong>Lecciones planificadas:</strong><br>
                    <input type="number" id="leccionesPlanificadas" min="1" max="200" value="8" class="input-field" style="width: 70px;" onchange="actualizarSemanasPreservandoContenido()"><br>
                    <strong style="margin-left: 8px;">Mes inicio - Mes final:</strong><br>
                    <input type="text" id="mesInicio" class="input-field" placeholder="Ej: Febrero" style="width: 48%; display: inline-block;">
                    <input type="text" id="mesFinal" class="input-field" placeholder="Ej: Marzo" style="width: 48%; display: inline-block;">
                </td>
            </tr>
        </table>

        <!-- EJES TRANSVERSALES -->
        <div class="section-title">Eje transversal del PNFT seg√∫n competencia MEP, marque con equis (x) el eje a desarrollar.</div>
        <div class="ejes-transversales">
            <div class="eje-option">
                <label>
                    <input type="checkbox" name="eje" value="ciudadania">
                    <span><strong>Ciudadan√≠a y √©tica digital</strong><br>
                    <small>Competencias para la ciudadan√≠a responsable y solidaria</small></span>
                </label>
            </div>
            <div class="eje-option">
                <label>
                    <input type="checkbox" name="eje" value="pensamiento">
                    <span><strong>Pensamiento computacional</strong><br>
                    <small>Competencias para la vida</small></span>
                </label>
            </div>
            <div class="eje-option">
                <label>
                    <input type="checkbox" name="eje" value="emprendimiento">
                    <span><strong>Emprendimiento e Innovaci√≥n</strong><br>
                    <small>Competencias para el empleo digno</small></span>
                </label>
            </div>
        </div>

        <!-- METODOLOG√çA ACTIVA -->
        <div class="section-title">Metodolog√≠a activa:</div>
        <select id="metodologiaActiva" class="select-field" onchange="mostrarDetalleMetodologia(this.value)">
            <option value="">Seleccionar metodolog√≠a</option>
            <option value="ABJ">Aprendizaje basado en juegos (ABJ) - 7 fases</option>
            <option value="ABR">Aprendizaje basado en retos (ABR) - 3 fases</option>
            <option value="APD">Aprendizaje Pensamiento por Dise√±o (APD) - 5 fases</option>
        </select>

        <!-- DETALLES DE METODOLOG√çAS -->
        <div id="detalleABJ" class="metodologia-detalle" style="display: none; background: #f8f9fa; padding: 12px; border-radius: 6px; margin: 8px 0;">
            <h4>Aprendizaje basado en juegos - 7 Fases:</h4>
            <ol>
                <li>Introducci√≥n del juego</li>
                <li>Establecimiento de reglas</li>
                <li>Pr√°ctica guiada</li>
                <li>Juego independiente</li>
                <li>Reflexi√≥n sobre el aprendizaje</li>
                <li>Evaluaci√≥n formativa</li>
                <li>Cierre y transferencia</li>
            </ol>
        </div>

        <div id="detalleABR" class="metodologia-detalle" style="display: none; background: #f8f9fa; padding: 12px; border-radius: 6px; margin: 8px 0;">
            <h4>Aprendizaje basado en retos - 3 Fases:</h4>
            <ol>
                <li>Presentaci√≥n del reto</li>
                <li>Investigaci√≥n y desarrollo</li>
                <li>Presentaci√≥n de soluciones</li>
            </ol>
        </div>

        <div id="detalleAPD" class="metodologia-detalle" style="display: none; background: #f8f9fa; padding: 12px; border-radius: 6px; margin: 8px 0;">
            <h4>Aprendizaje Pensamiento por Dise√±o - 5 Fases:</h4>
            <ol>
                <li>Empatizar</li>
                <li>Definir</li>
                <li>Idear</li>
                <li>Prototipar</li>
                <li>Evaluar</li>
            </ol>
        </div>

        <!-- PLANIFICACI√ìN POR SEMANAS -->
        <div class="section-title espacio-optimizado">Planificaci√≥n por Semanas</div>
        <div class="semanas-controls">
            <div>
                <strong>Lecciones totales: <span id="totalLecciones">8</span></strong> | 
                <strong>Semanas generadas: <span id="totalSemanas">2</span></strong>
            </div>
            <button type="button" class="btn-agregar-semana" onclick="agregarSemanaManual()">+ Agregar Semana</button>
        </div>
        
        <div id="semanasContainer">
            <!-- Las semanas se generar√°n aqu√≠ din√°micamente -->
        </div>

        <!-- REFLEXIONES DOCENTES -->
        <table>
            <tr>
                <td width="33%" class="section-title">¬øQu√© funcion√≥?</td>
                <td width="33%" class="section-title">¬øQu√© no funcion√≥?</td>
                <td width="34%" class="section-title">¬øQu√© puedo mejorar?</td>
            </tr>
            <tr>
                <td>
                    <textarea id="queFunciono" class="textarea-field" placeholder="Describa las estrategias que funcionaron bien..."></textarea>
                </td>
                <td>
                    <textarea id="queNoFunciono" class="textarea-field" placeholder="Describa las dificultades encontradas..."></textarea>
                </td>
                <td>
                    <textarea id="queMejorar" class="textarea-field" placeholder="Describa las mejoras para pr√≥ximas clases..."></textarea>
                </td>
            </tr>
        </table>

        <!-- OBSERVACIONES -->
        <div class="section-title">Observaciones y/o recomendaciones did√°cticas por nivel:</div>
        <textarea id="observaciones" class="textarea-field" placeholder="Observaciones generales sobre el desarrollo de las clases..." style="height: 80px;"></textarea>

        <!-- NOTA SOBRE IA -->
        <div class="info-note">
            <strong>Nota importante sobre el uso de IA:</strong> Lo que brinda la IA debe ser contextualizado por el educador, 
            quien decide, observa y ejecuta seg√∫n su criterio y conocimiento del grupo. La IA proporciona estrategias de mediaci√≥n 
            que deben ser definidas, reagrupadas y reestructuradas por el educador considerando el orden, estructura y forma de 
            implementaci√≥n m√°s adecuada.
        </div>

        <!-- FOOTER -->
        <div class="footer">
            DIDI - Departamento de Investigaci√≥n, Desarrollo e Implementaci√≥n<br>
            Direcci√≥n de Recursos Tecnol√≥gicos en Educaci√≥n
        </div>

        <!-- BOTONES DE ACCI√ìN -->
        <div class="action-buttons">
            <button onclick="nuevoPlan()" class="btn btn-outline">üÜï Nuevo</button>
            <button onclick="abrirPlan()" class="btn btn-outline">üìÇ Abrir</button>
            <button onclick="guardarPlan()" class="btn btn-primary">üíæ Guardar</button>
            <button onclick="mostrarOpcionesExportar()" class="btn btn-secondary">üìÑ Exportar</button>
            <button onclick="generarPromptCompleto()" class="btn btn-primary">ü§ñ Prompt IA General</button>
        </div>
    </div>

        <!-- MODAL PARA EXPORTAR - VERSI√ìN CORREGIDA Y FUNCIONAL -->
        <div id="exportarModal" class="modal">
            <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
                <button class="modal-close" onclick="cerrarExportModal()" 
                        style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 20px; cursor: pointer; z-index: 10;">&times;</button>
                
                <h3 style="margin-right: 30px;">üìÑ Exportar Plan</h3>
                
                <div class="file-save-info">
                    <strong>üí° Informaci√≥n:</strong> Los archivos se guardar√°n en la carpeta de descargas.
                </div>
                
                <!-- NOMBRE DEL ARCHIVO -->
                <div style="margin: 12px 0;">
                    <label for="nombreArchivo"><strong>Nombre del archivo:</strong></label>
                    <input type="text" id="nombreArchivo" class="input-field" value="Planeamiento-Did√°ctico">
                </div>
                
                <!-- OPCIONES DE CONTENIDO -->
                <div class="checkbox-group">
                    <h4>¬øQu√© desea incluir en la exportaci√≥n?</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div class="checkbox-item">
                            <label><input type="checkbox" id="exportarInformacionGeneral" checked> Informaci√≥n general</label>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" id="exportarSaberes" checked> Saberes y √°reas</label>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" id="exportarSemanas" checked> Planificaci√≥n por semanas</label>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" id="exportarReflexiones" checked> Reflexiones docentes</label>
                        </div>
                        <div class="checkbox-item">
                            <label><input type="checkbox" id="exportarSaberesGlobales" checked> Saberes globales seleccionados</label>
                        </div>
                    </div>
                </div>

                <div class="checkbox-group">
                    <h4>Elementos institucionales:</h4>
                    <div class="checkbox-item">
                        <label><input type="checkbox" id="incluirEncabezado" checked> Incluir encabezado institucional (MEP - Gobierno de Costa Rica)</label>
                    </div>
                    <div class="checkbox-item">
                        <label><input type="checkbox" id="incluirPiePagina" checked> Incluir pie de p√°gina institucional (PNFT - DRTE)</label>
                    </div>
                </div>
                
                <!-- FORMATOS DE EXPORTACI√ìN -->
                <div style="margin: 15px 0;">
                    <h4 style="margin-bottom: 10px;">Seleccione formato:</h4>
                    <div class="export-options">
                        <div class="export-option" id="opcionWord" onclick="seleccionarFormato('word', this)">
                            <div style="font-size: 2em;">üìù</div>
                            <strong>Word Editable</strong>
                            <small>Para modificar sin internet</small>
                        </div>
                        <div class="export-option" id="opcionPDF" onclick="seleccionarFormato('pdf', this)">
                            <div style="font-size: 2em;">üìä</div>
                            <strong>PDF para Imprimir</strong>
                            <small>Formato final oficial</small>
                        </div>
                    </div>
                </div>
                
                <!-- BOTONES DE ACCI√ìN -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="confirmarExportacion()" class="btn btn-primary" style="flex: 1; padding: 10px 16px;">üöÄ Exportar</button>
                    <button onclick="cerrarExportModal()" class="btn btn-outline" style="flex: 1; padding: 10px 16px;">‚ùå Cancelar</button>
                </div>
            </div>
        </div>

    <!-- MODAL PARA PROMPT IA -->
    <div id="promptModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="cerrarPromptModal()" style="position: absolute; right: 15px; top: 15px; background: none; border: none; font-size: 20px; cursor: pointer;">&times;</button>
            <h3>ü§ñ Generar Prompt para IA</h3>
            
            <div class="info-note">
                <strong>üìã Instrucciones para usar el prompt:</strong><br>
                1. Revise el texto completo y luego presione el bot√≥n copiar prompt.<br>
                2. Da click en la IA de preferencia y pegue el texto (Ctrl+V). <br>
                3. La IA generar√° estrategias de mediaci√≥n espec√≠ficas, las cuales deben ser personalizadas seg√∫n contexto educativo.<br>
                4. Revise y adapte las sugerencias a su contexto.
            </div>
            
            <div style="margin: 12px 0;">
                <label for="promptText"><strong>Prompt generado:</strong></label>
                <textarea id="promptText" class="textarea-field" rows="8" style="font-family:'Poppins', sans-serif; font-size: 11px;"></textarea>
            </div>
            
            <button onclick="copiarPrompt()" class="btn btn-primary" style="width: 50%; padding: 8px;">üìã Copiar Prompt</button>
            <div style="display: flex; gap: 6px; margin-top: 8px;">
                <button onclick="abrirEnCopilot()" class="btn btn-outline" style="flex: 1;">üöÄ Abrir en Copilot</button>
                <button onclick="abrirEnChatGPT()" class="btn btn-outline" style="flex: 1;">üí¨ Abrir en ChatGPT</button>
            </div>
            <button onclick="cerrarPromptModal()" class="btn btn-outline" style="width: 50%; margin-top: 8px; padding: 8px;">‚ùå Cerrar</button>
        </div>
    </div>

    <script>
        // ===== BASE DE DATOS COMPLETA PNFT =====
        const PNFT_DATA = {
          "Grupo Interactivo II y Transici√≥n": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Computadora", indicadores: ["Identificar qu√© es una computadora y algunas de sus caracter√≠sticas, a partir de experiencias pr√°cticas de interacci√≥n con dispositivos digitales."] },
                { nombre: "Software", indicadores: ["Reconocer elementos visuales b√°sicos de la interfaz de software (iconos, botones, ventanas), interactuando con ellos mediante el uso guiado de dispositivos digitales."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia", indicadores: ["Reconocer las herramientas de creaci√≥n de contenido multimedia seg√∫n su utilidad: editor gr√°fico, grabadora de audio y video, en la creaci√≥n de recursos digitales."] },
                { nombre: "Hardware", indicadores: ["Reconocer componentes b√°sicos del hardware, como dispositivos de entrada y salida de datos, explorando su funci√≥n al encender, usar o interactuar con la computadora en actividades cotidianas."] },
                { nombre: "Internet", indicadores: ["Reconocer qu√© es Internet y los requerimientos de un dispositivo para conectarse a Internet, realizando una exploraci√≥n dirigida."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Reconocer la conexi√≥n entre dispositivos por bluetooth y los requerimientos de dispositivos digitales para conectarse, a trav√©s de una exploraci√≥n dirigida."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n iconogr√°fico", indicadores: ["Reconocer el entorno de programaci√≥n iconogr√°fico, interactuando con bloques de la interfaz, como desplazamiento, apariencia o sonido, mediante el uso guiado del docente."] },
                { nombre: "Lateralidad y orientaci√≥n espacial", indicadores: ["Reconocer los conceptos de lateralidad y orientaci√≥n espacial en la construcci√≥n de secuencias de acciones para la soluci√≥n de retos de programaci√≥n."] },
                { nombre: "Evento", indicadores: ["Reconocer que un evento desencadena una acci√≥n, identificando la relaci√≥n de causa y efecto en juegos o actividades."] },
                { nombre: "Estado", indicadores: ["Reconocer el concepto de estado programando objetos que modifican las propiedades de orientaci√≥n y/o direcci√≥n."] },
                { nombre: "Algoritmo", indicadores: ["Reconocer el concepto de algoritmo mediante secuencias de acciones l√≥gicas y ordenadas, en la construcci√≥n de soluciones a desaf√≠os propuestos."] },
                { nombre: "Dato", indicadores: ["Reconocer la importancia del dato en contexto f√≠sico y en contexto digital mientras soluciona desaf√≠os propuestos."] },
                { nombre: "Estructuras repetitivas", indicadores: ["Reconocer estructuras repetitivas en secuencias de acciones durante la programaci√≥n guiada de objetos digitales, distinguiendo si una acci√≥n se repite un n√∫mero limitado o ilimitado de veces."] }
              ]
            },
            "Computaci√≥n f√≠sica y Rob√≥tica": {
              saberes: [
                { nombre: "Robot", indicadores: ["Reconocer qu√© es un robot, sus componentes y algunos de sus usos, mediante actividades l√∫dicas de exploraci√≥n o programaci√≥n guiada."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Dato", indicadores: ["Identificar el dato y su importancia en situaciones cotidianas, reconociendo diferentes tipos como texto, imagen, sonido o video."] },
                { nombre: "Estrategias para presentar datos", indicadores: ["Reconocer gr√°ficos pict√≥ricos como estrategia para representar datos recolectados en actividades l√∫dicas."] },
                { nombre: "Visualizaci√≥n de datos", indicadores: ["Interpretar gr√°ficos pict√≥ricos como parte de la visualizaci√≥n de datos (colores, formas, cantidades), con apoyo del docente, relacion√°ndolos con datos conocidos del entorno."] },
                { nombre: "Realidad aumentada", indicadores: ["Experimentar con realidad aumentada en entornos f√≠sicos mediante actividades sensoriales y l√∫dicas, con acompa√±amiento del docente."] }
              ]
            }
          },
          "1¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Computadora", indicadores: ["Reconocer la computadora como una herramienta tecnol√≥gica, identificando sus caracter√≠sticas b√°sicas, funciones e importancia en la vida cotidiana, por medio de la observaci√≥n y manipulaci√≥n pr√°ctica."] },
                { nombre: "Hardware", indicadores: ["Identificar el hardware b√°sico de una computadora, reconociendo dispositivos de entrada, salida y las acciones de encendido y apagado, mediante actividades pr√°cticas guiadas."] },
                { nombre: "Software", indicadores: ["Identificar el software de una computadora, reconociendo los elementos b√°sicos de la interfaz de usuario mediante actividades pr√°cticas guiadas."] },
                { nombre: "Conexi√≥n entre dispositivos (bluetooth)", indicadores: ["Reconocer el bluetooth como medio de conexi√≥n entre dispositivos utilizando dispositivos digitales en el aula."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia (audio, im√°genes)", indicadores: ["Utilizar herramientas de creaci√≥n de contenido multimedia para la creaci√≥n de audios e im√°genes durante actividades guiadas de producci√≥n digital en el aula."] },
                { nombre: "Internet", indicadores: ["Reconocer los dispositivos y programas que permiten la conexi√≥n para la navegaci√≥n en Internet."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n iconogr√°fico", indicadores: ["Reconocer elementos b√°sicos de un entorno de programaci√≥n iconogr√°fico, como bloques de desplazamiento, orientaci√≥n, apariencia, sonido, eventos y control, mediante la navegaci√≥n en la interfaz con actividades guiadas."] },
                { nombre: "Reconocimiento de patrones", indicadores: ["Reconocer patrones de movimiento en secuencias de instrucciones simples para que un personaje siga una ruta desde un punto de inicio hasta un punto de llegada."] },
                { nombre: "Estado", indicadores: ["Reconocer el estado de un objeto digital en relaci√≥n con su orientaci√≥n, direcci√≥n y tama√±o, identificando variaciones en dichos atributos, mediante secuencias de programaciones simples."] },
                { nombre: "Algoritmo", indicadores: ["Identificar un algoritmo en situaciones de la vida diaria, reconociendo secuencias l√≥gicas y ordenadas de acciones, para ser representadas de forma anal√≥gica (dibujos, tarjetas, gestos) y/o digital (entorno iconogr√°fico)."] },
                { nombre: "Dato", indicadores: ["Identificar el dato en situaciones de la vida diaria, reconociendo informaci√≥n valiosa en contextos f√≠sicos (como etiquetas, se√±ales, objetos) y digitales (como im√°genes, √≠conos o pantallas interactivas)."] },
                { nombre: "Estructuras repetitivas", indicadores: ["Reconocer estructuras repetitivas al identificar ciclos finitos (como una canci√≥n o rutina) e infinitos (como el tic-tac del reloj o el movimiento del ventilador) en situaciones de la vida diaria."] },
                { nombre: "Evento", indicadores: ["Reconocer el evento como relaci√≥n de causa y efecto al participar en juegos anal√≥gicos, identificando c√≥mo una acci√≥n provoca una respuesta o cambio observable durante la din√°mica."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Fundamentos de la IA", indicadores: ["Reconocer los fundamentos de la inteligencia artificial a trav√©s de objetos o situaciones del entorno donde esta tecnolog√≠a est√° presente, mediante actividades guiadas con apoyo visual o audiovisual."] },
                { nombre: "Asistentes virtuales", indicadores: ["Reconocer qu√© es un asistente virtual y sus funciones a partir de demostraciones guiadas o videos educativos."] }
              ]
            }
          },
          "2¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Identificar el funcionamiento de los componentes b√°sicos del hardware, reconociendo c√≥mo cuidarlos mientras utilizan la computadora en la cotidianidad."] },
                { nombre: "Software (programas)", indicadores: ["Explorar el funcionamiento de diferentes programas de software seg√∫n la tarea escolar asignada durante el trabajo en aula."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Reconocer el wifi como medio de conexi√≥n entre dispositivos conectando dispositivos digitales en el aula."] },
                { nombre: "Herramienta de productividad (procesador de texto)", indicadores: ["Utilizar herramientas de productividad como el procesador de texto, reconociendo la cinta de opciones, pesta√±as y comandos b√°sicos, as√≠ como sus funciones por teclado, durante la creaci√≥n de textos sencillos."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia (grabadora de audio y editores de gr√°ficos)", indicadores: ["Utilizar herramientas de creaci√≥n de contenido multimedia, como la grabadora de audio y editores de gr√°ficos, aplicando funciones b√°sicas como crear, editar y guardar archivos, durante actividades guiadas de producci√≥n digital en el aula."] },
                { nombre: "Internet", indicadores: ["Aplicar normas b√°sicas de navegaci√≥n por internet, para acceder a p√°ginas educativas seguras, bajo acompa√±amiento del docente."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n por bloques", indicadores: ["Aplicar el uso del entorno de programaci√≥n por bloques, explorando la interfaz y el √°rea de bloques mientras construye secuencias de acciones que representen historias cotidianas."] },
                { nombre: "Algoritmo", indicadores: ["Dise√±ar un algoritmo en lenguaje natural como una secuencia ordenada que resuelve situaciones de la vida cotidiana."] },
                { nombre: "Dato", indicadores: ["Clasificar el dato como num√©rico o de texto en ejemplos de la vida cotidiana, valorando su uso en actividades del entorno cercano."] },
                { nombre: "Variable", indicadores: ["Identificar una variable in contextos de la vida cotidiana, observando elementos que cambian en relaci√≥n con otros (como edad, cantidad, clima o tiempo de actividad)."] },
                { nombre: "Estructuras repetitivas", indicadores: ["Identificar estructuras repetitivas en actividades programadas, diferenciando entre ciclos finitos e infinitos seg√∫n la cantidad de repeticiones requeridas."] },
                { nombre: "Estructuras condicionales", indicadores: ["Aplicar estructuras condicionales simples en un entorno de programaci√≥n por bloques en la resoluci√≥n de un ejercicio programado."] },
                { nombre: "Operadores aritm√©ticos", indicadores: ["Reconocer los operadores aritm√©ticos de suma y resta en situaciones de la vida cotidiana y su uso en un entorno de programaci√≥n por bloques."] },
                { nombre: "Operador relacional", indicadores: ["Reconocer el operador relacional \"igual que\" en situaciones de la vida cotidiana y su uso en un entorno de programaci√≥n por bloques."] },
                { nombre: "Evento", indicadores: ["Reconocer el evento en un entorno de programaci√≥n por bloques que activa una acci√≥n o cambio visible en un objeto del programa."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Fundamentos de la IA", indicadores: ["Describir los fundamentos de la inteligencia artificial en situaciones cotidianas, utilizando ejemplos guiados y preguntas orientadoras."] },
                { nombre: "Asistentes virtuales", indicadores: ["Reconocer el uso de asistentes virtuales en situaciones cotidianas, mediante ejemplos guiados que permitan la interacci√≥n."] }
              ]
            }
          },
          "3¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Explicar las funciones b√°sicas del hardware (entrada, procesamiento, almacenamiento y salida), en actividades pr√°cticas con dispositivos computacionales en el aula."] },
                { nombre: "Redes de comunicaci√≥n", indicadores: ["Describir qu√© son las redes de comunicaci√≥n y c√≥mo funciona una red local, a partir de la observaci√≥n y la pr√°ctica de intercambio de informaci√≥n entre dispositivos conectados en el aula."] },
                { nombre: "Gesti√≥n de archivos", indicadores: ["Reconocer la gesti√≥n de archivos como proceso para la organizaci√≥n y clasificaci√≥n de la informaci√≥n, mediante el uso de carpetas, subcarpetas y la exploraci√≥n de archivos digitales."] },
                { nombre: "Herramienta de productividad (editor de presentaciones)", indicadores: ["Utilizar herramientas de productividad, como el editor de presentaciones, empleando la cinta de opciones, pesta√±as, comandos b√°sicos y sus funciones por teclado en la elaboraci√≥n de presentaciones digitales."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia (video)", indicadores: ["Aplicar herramientas de creaci√≥n de contenido multimedia en la creaci√≥n, edici√≥n y guardado de videos, para incorporarlos en sus producciones."] },
                { nombre: "Navegator", indicadores: ["Identificar el navegador como una herramienta digital, reconociendo sus partes y usos en actividades de exploraci√≥n guiada por el docente."] },
                { nombre: "Buscador", indicadores: ["Identificar el buscador como una herramienta digital para acceder a informaci√≥n, distinguiendo sitios confiables y no confiables durante la exploraci√≥n dirigida en buscadores infantiles."] },
                { nombre: "Netiqueta", indicadores: ["Identificar normas b√°sicas de netiqueta que deben seguir al participar en diferentes procesos de comunicaci√≥n."] },
                { nombre: "Comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica", indicadores: ["Identificar el correo electr√≥nico como una herramienta de comunicaci√≥n asincr√≥nica, reconociendo sus caracter√≠sticas y su uso en actividades digitales guiadas."] },
                { nombre: "Huella digital", indicadores: ["Reconocer qu√© es la huella digital y c√≥mo puede afectar su privacidad y seguridad en l√≠nea, identificando que sus acciones en Internet dejan rastros que deben cuidarse."] },
                { nombre: "Software malicioso", indicadores: ["Reconocer el virus inform√°tico como un tipo de software malicioso, explicando de forma sencilla sus consecuencias, como p√©rdida de informaci√≥n o mal funcionamiento en los dispositivos."] },
                { nombre: "Riesgo en l√≠nea", indicadores: ["Reconocer algunos riesgos en l√≠nea como los perfiles falsos, la p√©rdida de privacidad, el contacto con extra√±os y la adicci√≥n al uso de dispositivos, identificando medidas b√°sicas para protegerse en estas situaciones."] },
                { nombre: "Medidas de seguridad web", indicadores: ["Reconocer el control parental como una medida de seguridad web en el uso de Internet que protege frente a riesgos y limita el acceso a contenido inapropiado."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Algoritmo", indicadores: ["Reconocer la estructura y caracter√≠sticas de un algoritmo en diferentes representaciones, valorando el orden, inicio-fin y l√≥gica de pasos en la soluci√≥n de situaciones cotidianas."] },
                { nombre: "Variable", indicadores: ["Utilizar la gesti√≥n de una variable en un entorno de programaci√≥n por bloques declarando su tipo, asignando valores y utilizando su contenido en la resoluci√≥n de un ejercicio programado."] },
                { nombre: "Operadores aritm√©ticos", indicadores: ["Utilizar operadores aritm√©ticos de multiplicaci√≥n y divisi√≥n y/o operadores relacionales como \"menor que\", \"mayor que\" o \"igual que\", en la resoluci√≥n de un ejercicio programado."] },
                { nombre: "Operadores relacionales", indicadores: ["Utilizar operadores aritm√©ticos de multiplicaci√≥n y divisi√≥n y/o operadores relacionales como \"menor que\", \"mayor que\" o \"igual que\", en la resoluci√≥n de un ejercicio programado."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Desaf√≠os de la IA", indicadores: ["Identificar los desaf√≠os de la inteligencia artificial en la vida cotidiana y algunas recomendaciones para su uso seguro y responsable, con la ayuda de ejemplos guiados."] }
              ]
            }
          },
          "4¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Clasificar componentes de hardware seg√∫n su funci√≥n, distinguiendo entre dispositivos computacionales y perif√©ricos en contextos cotidianos."] },
                { nombre: "Software", indicadores: ["Reconocer el software identificando sus tipos (de sistema, de aplicaci√≥n y utilitarios), valorando su funci√≥n en el uso cotidiano."] },
                { nombre: "Redes de comunicaci√≥n", indicadores: ["Reconocer las redes de comunicaci√≥n identificando la funcionalidad y aplicaci√≥n de una red local en el intercambio de informaci√≥n."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Reconocer la conexi√≥n entre dispositivos identificando si es f√≠sica (cableada) o inal√°mbrica (bluetooth, Wi-Fi)."] },
                { nombre: "Gesti√≥n de archivos", indicadores: ["Organizar archivos y carpetas, aplicando acciones b√°sicas como crear, mover, copiar, renombrar y eliminar."] },
                { nombre: "Herramienta de productividad (procesador de texto, editor de presentaciones)", indicadores: ["Utilizar herramientas de productividad en la creaci√≥n de contenidos que incluyan texto, im√°genes y formatos b√°sicos."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia (Editor gr√°fico)", indicadores: ["Aplicar herramientas de creaci√≥n de contenido multimedia utilizando funciones b√°sicas de creaci√≥n, edici√≥n y guardado de im√°genes."] },
                { nombre: "Navegador", indicadores: ["Utilizar navegadores y buscadores web en la b√∫squeda de informaci√≥n en internet siguiendo una consigna dada."] },
                { nombre: "Buscador", indicadores: ["Utilizar navegadores y buscadores web en la b√∫squeda de informaci√≥n en internet siguiendo una consigna dada."] },
                { nombre: "Internet", indicadores: ["Identificar dispositivos que se conectan a internet describiendo sus funciones b√°sicas."] },
                { nombre: "Netiqueta", indicadores: ["Aplicar normas de netiqueta durante la interacci√≥n en entornos digitales."] },
                { nombre: "Comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica (chat)", indicadores: ["Identificar el chat como herramienta de comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica."] },
                { nombre: "Huella digital", indicadores: ["Identificar los usos e implicaciones de la huella digital, reconociendo c√≥mo las acciones dejan rastros permanentes."] },
                { nombre: "Contrase√±as seguras", indicadores: ["Identificar qu√© es una contrase√±a segura y sus elementos b√°sicos."] },
                { nombre: "Hackeo", indicadores: ["Identificar qu√© es hackeo, phishing y conexiones inseguras, reconociendo situaciones de riesgo."] },
                { nombre: "Software malicioso", indicadores: ["Identificar qu√© es un virus inform√°tico como tipo de software malicioso."] },
                { nombre: "Antivirus", indicadores: ["Identificar la funci√≥n y caracter√≠sticas de un antivirus."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n por bloques", indicadores: ["Utilizar el entorno de programaci√≥n por bloques explorando la interfaz y organizando bloques en la resoluci√≥n de retos programados."] },
                { nombre: "Estado", indicadores: ["Identificar el concepto de estado, reconociendo cambios en las propiedades de orientaci√≥n, direcci√≥n y tama√±o."] },
                { nombre: "Algoritmo (pseudoc√≥digo)", indicadores: ["Hacer uso de algoritmos en pseudoc√≥digo utilizando instrucciones de forma l√≥gica y estructurada."] },
                { nombre: "Dato", indicadores: ["Organizar datos tipo num√©rico y de texto, reconociendo su uso en situaciones cotidianas."] },
                { nombre: "Variable", indicadores: ["Gestionar una variable en la resoluci√≥n de ejercicios a trav√©s de algoritmos o actividades programadas."] },
                { nombre: "Estructuras repetitivas", indicadores: ["Utilizar estructuras repetitivas en pseudoc√≥digo o programaci√≥n por bloques."] },
                { nombre: "Estructuras condicionales", indicadores: ["Utilizar estructuras condicionales simples y compuestas en pseudoc√≥digo o programaci√≥n."] },
                { nombre: "Operadores aritm√©ticos", indicadores: ["Utilizar operadores aritm√©ticos de suma, resta, multiplicaci√≥n y divisi√≥n en pseudoc√≥digo o programaci√≥n."] },
                { nombre: "Operadores relacionales", indicadores: ["Utilizar operadores relacionales en pseudoc√≥digo o programaci√≥n, comparando valores."] },
                { nombre: "Eventos", indicadores: ["Utilizar eventos en pseudoc√≥digo o programaci√≥n para el control de acciones y reacciones."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Fundamentos de la IA", indicadores: ["Identificar los fundamentos de la inteligencia artificial, reconociendo c√≥mo aprende, toma decisiones y se diferencia de otros sistemas automatizados."] },
                { nombre: "Asistentes virtuales", indicadores: ["Explicar el aporte de los asistentes virtuales en situaciones cotidianas, mediante el an√°lisis de ejemplos visuales, simulaciones o actividades guiadas."] }
              ]
            }
          },
          "5¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Identificar dispositivos de hardware de entrada y salida mixtos como la impresora multifuncional y las pantallas interactivas."] },
                { nombre: "Software", indicadores: ["Identificar la funcionalidad y el prop√≥sito de los diferentes softwares de ofim√°tica, reconociendo su utilidad en distintos tipos de archivos digitales escolares."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Identificar las formas de conexi√≥n entre dispositivos, comprendiendo los tipos de comunicaci√≥n y m√©todos b√°sicos para la transmisi√≥n de archivos."] },
                { nombre: "Sistema operativo", indicadores: ["Identificar la funcionalidad del escritorio en un sistema operativo, reconociendo los elementos b√°sicos de la barra de tareas."] },
                { nombre: "Herramienta de productividad (hoja de c√°lculo)", indicadores: ["Identificar la funcionalidad de la hoja de c√°lculo como herramienta de productividad, aplicando opciones de edici√≥n y formato."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia (audio y video)", indicadores: ["Elaborar contenido (audio y/o video) aplicando herramientas de creaci√≥n y edici√≥n de contenido multimedia disponibles."] },
                { nombre: "Buscador", indicadores: ["Realizar b√∫squedas eficientes en internet utilizando un buscador, aplicando filtros y comandos b√°sicos, y reconociendo dominios confiables (.edu, .go, .org, .com)."] },
                { nombre: "Derechos de autor", indicadores: ["Reconocer qu√© es derecho de autor y c√≥mo incorporarlo en sus producciones, evitando el plagio al citar adecuadamente las fuentes utilizadas."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n por bloques para computaci√≥n f√≠sica", indicadores: ["Utilizar el entorno de programaci√≥n por bloques para computaci√≥n f√≠sica explorando la interfaz y organizando bloques."] },
                { nombre: "L√≥gica de programaci√≥n", indicadores: ["Reconocer proposiciones como afirmaciones verdaderas o falsas en el contexto de la l√≥gica de programaci√≥n."] },
                { nombre: "Algoritmo (Diagrama de flujo)", indicadores: ["Aplicar mediante diagramas de flujo un algoritmo, utilizando s√≠mbolos y secuencias l√≥gicas."] },
                { nombre: "Dato", indicadores: ["Utilizar datos tipo booleano en la resoluci√≥n de problemas en entornos de programaci√≥n."] },
                { nombre: "Variable", indicadores: ["Aplicar la gesti√≥n de variables en programaci√≥n, modificando su valor durante la ejecuci√≥n de algoritmos."] },
                { nombre: "Colecci√≥n de datos", indicadores: ["Organizar datos en programaci√≥n mediante el uso de listas o agrupaciones de elementos con caracter√≠sticas comunes."] },
                { nombre: "Estructuras condicionales", indicadores: ["Aplicar estructuras condicionales m√∫ltiples en diagramas de flujo o programaci√≥n."] },
                { nombre: "Operadores L√≥gicos", indicadores: ["Reconocer operadores l√≥gicos de conjunci√≥n (Y) y disyunci√≥n (O) en la resoluci√≥n de problemas."] },
                { nombre: "Procedimientos/funciones", indicadores: ["Reconocer procedimientos o funciones en programaci√≥n, comprendiendo c√≥mo se declaran, invocan y se usan par√°metros y argumentos."] }
              ]
            },
            "Computaci√≥n f√≠sica y Rob√≥tica": {
              saberes: [
                { nombre: "Robot", indicadores: ["Reconocer qu√© es y qu√© no es un robot, identificando sus componentes b√°sicos como el cuerpo, el sistema sensorial y el sistema de control."] },
                { nombre: "Computaci√≥n f√≠sica", indicadores: ["Reconocer los componentes b√°sicos de la computaci√≥n f√≠sica, como el microcontrolador, sensores, actuadores y el entorno de programaci√≥n."] },
                { nombre: "Circuito el√©ctrico", indicadores: ["Identificar fundamentos de electr√≥nica, reconociendo la funci√≥n de los pines de entrada y salida, as√≠ como la diferencia entre se√±ales anal√≥gicas y digitales durante la construcci√≥n o simulaci√≥n de circuitos."] },
                { nombre: "Fundamentos de electr√≥nica", indicadores: ["Identificar fundamentos de electr√≥nica, reconociendo la funci√≥n de los pines de entrada y salida, as√≠ como la diferencia entre se√±ales anal√≥gicas y digitales."] },
                { nombre: "Microcontrolador", indicadores: ["Reconocer el funcionamiento b√°sico de un microcontrolador, identificando los pines digitales y anal√≥gicos, la placa de expansi√≥n y la comunicaci√≥n entre el programa y la tarjeta a trav√©s de actividades pr√°cticas o simuladas."] },
                { nombre: "Sensor", indicadores: ["Identificar sensores integrados y externos, reconociendo su funcionamiento y la forma de conectarlos a VCC y GND."] },
                { nombre: "Actuador", indicadores: ["Identificar actuadores integrados y externos, reconociendo c√≥mo se conectan a VCC y GND mientras generan una salida f√≠sica."] },
                { nombre: "Dom√≥tica", indicadores: ["Identificar usos y aplicaciones de la dom√≥tica, reconociendo c√≥mo la automatizaci√≥n mejora la comodidad y eficiencia."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Dato", indicadores: ["Identificar el dato de tipo num√©rico y de texto en situaciones cotidianas, a partir del registro de informaci√≥n."] },
                { nombre: "Recolecci√≥n de datos", indicadores: ["Reconocer t√©cnicas de recolecci√≥n de datos seg√∫n el tipo de informaci√≥n que se desea obtener."] },
                { nombre: "Almacenamiento de datos", indicadores: ["Identificar formas de almacenamiento de datos, reconociendo c√≥mo se utilizan archivos locales y hojas de c√°lculo."] },
                { nombre: "Visualizaci√≥n de datos", indicadores: ["Identificar la visualizaci√≥n de datos mediante formas de representaci√≥n como gr√°ficos o tablas."] },
                { nombre: "Estrategias para presentar datos", indicadores: ["Reconocer las tablas como una estrategia para presentar datos organizadamente."] },
                { nombre: "Herramientas generativas", indicadores: ["Reconocer herramientas digitales generativas (texto, imagen o audio) que producen contenido a partir de instrucciones sencillas."] },
                { nombre: "Desaf√≠os de la IA", indicadores: ["Reconocer desaf√≠os de la inteligencia artificial relacionados con la protecci√≥n de la informaci√≥n personal sensible."] }
              ]
            }
          },
          "6¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Analizar las funciones de los componentes internos del hardware como la memoria RAM, tarjeta madre, disco duro, microprocesador y tarjetas de red, video y sonido."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Explicar c√≥mo las direcciones IP permiten la conexi√≥n entre dispositivos y su comunicaci√≥n dentro de una red local o en internet."] },
                { nombre: "Redes de comunicaci√≥n", indicadores: ["Describir diferentes tipos de redes de comunicaci√≥n (red fija telef√≥nica, red m√≥vil, red de televisi√≥n por cable y red satelital)."] },
                { nombre: "Gesti√≥n de archivos", indicadores: ["Analizar la gesti√≥n de archivos considerando las propiedades de los archivos digitales (tama√±o, tipo y extensi√≥n) y aplicando procesos de compresi√≥n y descompresi√≥n."] },
                { nombre: "Sistema operativo", indicadores: ["Identificar la funcionalidad del escritorio en un sistema operativo, reconociendo los elementos b√°sicos de la barra de tareas como altavoces, auriculares, estado de la bater√≠a y control de audio, durante el uso cotidiano."] },
                { nombre: "Herramienta of productividad", indicadores: ["Utilizar la herramienta de productividad seleccionando entre opciones de ofim√°tica local o en l√≠nea, seg√∫n el contexto de uso."] },
                { nombre: "Herramientas de creaci√≥n de contenido multimedia", indicadores: ["Crear contenido (imagen, audio y/o video) con herramientas de creaci√≥n de contenido multimedia disponibles."] },
                { nombre: "Internet", indicadores: ["Identificar el funcionamiento b√°sico de Internet, reconociendo c√≥mo se establece la conectividad y el rol de los proveedores de servicios."] },
                { nombre: "Comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica", indicadores: ["Aplicar la comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica en la creaci√≥n de documentos, organizaci√≥n de carpetas y gesti√≥n del correo electr√≥nico."] },
                { nombre: "Almacenamiento en la nube", indicadores: ["Crear archivos digitales en plataformas de almacenamiento en la nube, configurando los permisos de uso compartido."] },
                { nombre: "Referencias bibliogr√°ficas", indicadores: ["Aplicar un formato b√°sico de referencias bibliogr√°ficas (autor, t√≠tulo y fuente) en las producciones."] },
                { nombre: "Internet de las cosas", indicadores: ["Reconocer aplicaciones del Internet de las Cosas (IoT) en la cotidianidad."] },
                { nombre: "Moneda virtual", indicadores: ["Reconocer la utilidad e implicaciones b√°sicas de las monedas virtuales."] },
                { nombre: "Huella digital", indicadores: ["Aplicar medidas b√°sicas para proteger la privacidad en l√≠nea, gestionando su huella digital."] },
                { nombre: "Contrase√±as seguras", indicadores: ["Reconocer la importancia de las contrase√±as seguras, aplicando estrategias b√°sicas como el uso de doble factor."] },
                { nombre: "Software malicioso", indicadores: ["Identificar las formas comunes de propagaci√≥n de software malicioso y estrategias b√°sicas de prevenci√≥n."] },
                { nombre: "Riesgos en l√≠nea", indicadores: ["Identificar riesgos en l√≠nea como ciberacoso, contenido inapropiado y suplantaci√≥n de identidad."] },
                { nombre: "Medidas de seguridad en la web", indicadores: ["Identificar medidas de seguridad en la web, reconociendo la diferencia entre HTTPS y HTTP."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "L√≥gica de programaci√≥n (tablas de verdad)", indicadores: ["Aplicar la l√≥gica de programaci√≥n (tablas de verdad) con operadores de conjunci√≥n y disyunci√≥n."] },
                { nombre: "Procedimientos/funciones", indicadores: ["Emplear procedimientos o funciones (declaraci√≥n, invocaci√≥n, par√°metros y argumentos) en la resoluci√≥n de ejercicios programados."] }
              ]
            },
            "Computaci√≥n f√≠sica y Rob√≥tica": {
              saberes: [
                { nombre: "Computaci√≥n f√≠sica", indicadores: ["Aplicar la computaci√≥n f√≠sica en la creaci√≥n de soluciones automatizadas, como respuesta a necesidades concretas del entorno cotidiano."] },
                { nombre: "Prototipos", indicadores: ["Dise√±ar prototipos de sistemas automatizados, aplicando conocimientos de computaci√≥n f√≠sica para resolver necesidades concretas."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Dato", indicadores: ["Aplicar registros como datos relevantes, organizando informaci√≥n en tablas a partir de gastos, notas, actividades deportivas o registros b√°sicos de salud."] },
                { nombre: "Recolecci√≥n de datos", indicadores: ["Seleccionar t√©cnicas de recolecci√≥n de datos aplic√°ndolas seg√∫n el tipo de informaci√≥n que se desea obtener."] },
                { nombre: "Almacenamientos de datos", indicadores: ["Aplicar formas de almacenamiento de datos como archivos locales o en l√≠nea y herramientas digitales como hojas de c√°lculo, organizando informaci√≥n recolectada."] },
                { nombre: "Visualizaci√≥n de datos", indicadores: ["Aplicar t√©cnicas de visualizaci√≥n de datos, creando representaciones gr√°ficas simples como gr√°ficos pict√≥ricos o de barras."] },
                { nombre: "Estrategias para presentar datos", indicadores: ["Crear gr√°ficos de barras o lineales a partir de datos, aplicando estrategias para representar datos."] }
              ]
            }
          },
          "7¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Computadora", indicadores: ["Aplicar reglas b√°sicas y responsabilidades durante el uso de una computadora, contribuyendo al cuidado, seguridad y prolongaci√≥n de su vida √∫til."] },
                { nombre: "Hardware", indicadores: ["Clasificar tipos de computadoras y sus componentes principales de hardware, identificando funciones de perif√©ricos comunes."] },
                { nombre: "Software", indicadores: ["Distinguir los tipos de software relacion√°ndolos con sus funciones y usos en tareas cotidianas."] },
                { nombre: "Redes de comunicaci√≥n", indicadores: ["Identificar tipos de redes de comunicaci√≥n y sus dispositivos principales (m√≥dem, router y puntos de acceso), explicando su funcionamiento y principios de comunicaci√≥n durante la conexi√≥n a Internet en contextos cotidianos."] },
                { nombre: "Sistema operativo", indicadores: ["Identificar las categor√≠as de los sistemas operativos (escritorio y dispositivos m√≥viles), describiendo su funci√≥n b√°sica."] },
                { nombre: "Gesti√≥n de archivos", indicadores: ["Aplicar las propiedades (tama√±o, tipo y extensi√≥n) en la gesti√≥n de archivos para compartir informaci√≥n en diferentes entornos digitales."] },
                { nombre: "Herramienta of productividad (Procesador de texto, Editor de presentaciones)", indicadores: ["Aplicar la herramienta de productividad c√≥mo procesador de texto y/o editor de presentaci√≥n para crear productos comunicativos."] },
                { nombre: "Herramientas of creaci√≥n de contenido multimedia (Editor de gr√°ficos)", indicadores: ["Dise√±ar productos visuales con herramientas de creaci√≥n multimedia utilizando editores gr√°ficos, aplicando principios b√°sicos de dise√±os y formatos adecuados seg√∫n la calidad requerida."] },
                { nombre: "Internet", indicadores: ["Reconocer el funcionamiento de Internet, comprendiendo la conectividad entre dispositivos y el rol de los proveedores de servicio (ISP)."] },
                { nombre: "Navegador", indicadores: ["Utilizar el navegador y el buscador web para acceder y localizar informaci√≥n en l√≠nea, gestionando pesta√±as."] },
                { nombre: "Buscador", indicadores: ["Utilizar el navegador y el buscador web para acceder y localizar informaci√≥n en l√≠nea, gestionando pesta√±as."] },
                { nombre: "Netiqueta", indicadores: ["Utilizar herramientas de comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica, aplicando normas de netiqueta."] },
                { nombre: "Comunicaci√≥n y colaboraci√≥n sincr√≥nica/asincr√≥nica", indicadores: ["Utilizar herramientas de comunicaci√≥n y colaboraci√≥n sincr√≥nica y asincr√≥nica, aplicando normas de netiqueta."] },
                { nombre: "Almacenamiento en la nube", indicadores: ["Utilizar el almacenamiento en la nube para guardar, organizar y compartir archivos digitales."] },
                { nombre: "Referencias bibliogr√°ficas", indicadores: ["Aplicar formatos b√°sicos de referencias bibliogr√°ficas en producciones digitales o escritas."] },
                { nombre: "Criptomonedas", indicadores: ["Reconocer la utilidad e implicaciones del uso de criptomonedas en entornos digitales cotidianos."] },
                { nombre: "Contrase√±as seguras", indicadores: ["Crear contrase√±as seguras utilizando generadores aleatorios."] },
                { nombre: "Software malicioso", indicadores: ["Reconocer las caracter√≠sticas del software malicioso, analizando los riesgos asociados."] },
                { nombre: "Riesgos en l√≠nea", indicadores: ["Identificar riesgos en l√≠nea como la suplantaci√≥n de identidad, grooming, phishing y noticias falsas."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno de programaci√≥n textual o bloques", indicadores: ["Reconocer un entorno de programaci√≥n textual o bloques, identificando sus funciones."] },
                { nombre: "L√≥gica de programaci√≥n", indicadores: ["Identificar la l√≥gica de programaci√≥n con el uso de proposiciones y conectores l√≥gicos (AND, OR, NOT)."] },
                { nombre: "Algoritmo", indicadores: ["Reconocer el algoritmo identificando su estructura (entrada, proceso, salida) y aplicando sus caracter√≠sticas."] },
                { nombre: "Dato", indicadores: ["Identificar tipos of dato y formas of almacenamiento, aplic√°ndolos en la creation of algoritmos."] },
                { nombre: "Variable", indicadores: ["Identificar tipos of variable, aplicando su gesti√≥n mediante declaraciones y asignaciones."] },
                { nombre: "Estructuras condicionales", indicadores: ["Aplicar estructuras condicionales en un entorno de programaci√≥n para la resoluci√≥n de desaf√≠os."] },
                { nombre: "Estructuras repetitivas", indicadores: ["Aplicar estructuras repetitivas en un entorno de programaci√≥n para resolver desaf√≠os."] },
                { nombre: "Operadores aritm√©ticos", indicadores: ["Aplicar operadores aritm√©ticos (suma, resta, multiplicaci√≥n y divisi√≥n) para resolver c√°lculos."] },
                { nombre: "Operadores relacionales", indicadores: ["Aplicar operadores relacionales para realizar comparaciones."] },
                { nombre: "Operadores l√≥gicos", indicadores: ["Aplicar operadores l√≥gicos (Y, O, NO) en la resoluci√≥n de desaf√≠os de programaci√≥n."] },
                { nombre: "Evento", indicadores: ["Aplicar un evento como acci√≥n que se detona mediante una causa y un efecto."] },
                { nombre: "Procedimientos y/o funciones", indicadores: ["Aplicar procedimientos y/o funciones como structure modular, a trav√©s de su declaraci√≥n e invocaci√≥n."] }
              ]
            },
            "Ciencia de datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Dato", indicadores: ["Identificar tipos of dato (num√©ricos, de texto, de ubicaci√≥n y de im√°genes), analizando c√≥mo influye en decisiones."] },
                { nombre: "Fundamentos de la IA", indicadores: ["Reconocer los fundamentos of la inteligencia artificial, identificando el concepto y sus aplicaciones."] },
                { nombre: "Asistentes virtuales", indicadores: ["Identificar qu√© son los asistentes virtuales basados en inteligencia artificial, reconociendo su utilidad."] }
              ]
            }
          },
          "8¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Hardware", indicadores: ["Analizar el funcionamiento de los componentes internos del hardware, describiendo c√≥mo influyen en el rendimiento el rendimiento y desempe√±o del equipo mediante ejemplos pr√°cticos o simulaciones."] },
                { nombre: "Software", indicadores: ["Analizar los tipos of software seg√∫n su funci√≥n, comparando las caracter√≠sticas y usos en diferentes contextos personales, acad√©micos o sociales."] },
                { nombre: "Redes de comunicaci√≥n", indicadores: ["Identificar las funciones of las unidades of almacenamiento of las redes of comunicaci√≥n, aplic√°ndolas en la gesti√≥n y organizaci√≥n of archivos compartidos en entornos digitales."] },
                { nombre: "Conexi√≥n entre dispositivos", indicadores: ["Distinguir las formas of conexi√≥n entre dispositivos mediante comunicaci√≥n f√≠sica o inal√°mbrica, identificando sus aplicaciones en contextos cotidianos."] },
                { nombre: "Sistema Operativo", indicadores: ["Reconocer las caracter√≠sticas del sistema operativo y la diferencia entre software libre y de paga."] },
                { nombre: "Gesti√≥n of archivos", indicadores: ["Aplicar la compresi√≥n y descompresi√≥n of archivos como parte of la gesti√≥n of archivos digitales."] },
                { nombre: "Herramienta of productividad (Hoja of c√°lculo)", indicadores: ["Utilizar la hoja of c√°lculo como herramienta of productividad en la organizaci√≥n y representaci√≥n of datos."] },
                { nombre: "Herramientas of creaci√≥n of contenido multimedia (Edici√≥n of audio y video)", indicadores: ["Utilizar herramientas of creation of contenido multimedia en la edici√≥n of audio o video, aplicando criterios of dise√±o y formato en relaci√≥n con la calidad del producto."] },
                { nombre: "Buscador", indicadores: ["Utilizar el buscador web como herramienta para la localizaci√≥n of informaci√≥n, aplicando criterios que identifiquen fuentes confiables."] },
                { nombre: "Plataformas of creaci√≥n of contenido", indicadores: ["Utilizar plataformas of creation of contenido digital en la elaboraci√≥n of infograf√≠as, diagramas o presentaciones."] },
                { nombre: "Licencia", indicadores: ["Reconocer la licencia digital en el uso of contenido en l√≠nea, valorando sus alcances y limitaciones."] },
                { nombre: "Internet of las cosas", indicadores: ["Analizar aplicaciones del Internet of las cosas en la automatizaci√≥n of tareas."] },
                { nombre: "Hackeo", indicadores: ["Reconocer el hackeo como una amenaza digital, diferenciando tipos of hacker."] },
                { nombre: "Software malicioso", indicadores: ["Aplicar medidas of protecci√≥n digital mediante el reconocimiento of tipos of software malicioso y el uso adecuado del antivirus."] },
                { nombre: "Antivirus", indicadores: ["Aplicar medidas of protecci√≥n digital mediante el reconocimiento of tipos of software malicioso y el uso adecuado del antivirus."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno of programaci√≥n textual o bloques para programar mecanismos rob√≥ticos", indicadores: ["Aplicar el entorno of programaci√≥n textual o por bloques para programar mecanismos rob√≥ticos, utilizando estructuras y eventos."] },
                { nombre: "Colecci√≥n of datos", indicadores: ["Gestionar una colecci√≥n of datos como listas o arreglos mediante su creation, recorrido y modificaci√≥n."] }
              ]
            },
            "Computaci√≥n f√≠sica y Rob√≥tica": {
              saberes: [
                { nombre: "Robot", indicadores: ["Reconocer qu√© es un robot, sus tipos y componentes (cuerpo, sistema sensorial and sistema of control)."] },
                { nombre: "Rob√≥tica", indicadores: ["Diferenciar la computaci√≥n f√≠sica con la rob√≥tica, identificando c√≥mo los sensores, actuadores y sistemas of control se integran."] },
                { nombre: "Mec√°nica aplicada a la rob√≥tica", indicadores: ["Emplear principios of la mec√°nica aplicados a la rob√≥tica, como la estructura y la estabilidad."] },
                { nombre: "Mecanismos", indicadores: ["Reconocer los tipos of mecanismos, identificando su funci√≥n principal en la transmisi√≥n y transformaci√≥n del movimiento."] },
                { nombre: "Circuito el√©ctrico", indicadores: ["Identificar los componentes of un circuito el√©ctrico y su funcionamiento."] },
                { nombre: "Fundamentos of electr√≥nica", indicadores: ["Identificar fundamentos of electr√≥nica, reconociendo la funci√≥n of pines of entrada y salida."] },
                { nombre: "Microcontrolador", indicadores: ["Comprender los componentes b√°sicos of un microcontrolador, aplicando la funci√≥n of pines digitales y anal√≥gicos."] },
                { nombre: "Sensor", indicadores: ["Utilizar un sensor integrado y/o externo, comprendiendo su funci√≥n y su correcta conexi√≥n a VCC y GND."] },
                { nombre: "Actuador", indicadores: ["Utilizar un actuador integrado y/o externo, comprendiendo su funci√≥n y c√≥mo se conecta correctamente a VCC y GND."] }
              ]
            },
            "Ciencia of datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Recolecci√≥n of datos", indicadores: ["Aplicar t√©cnicas of recolecci√≥n of datos mediante registros escolares y personales."] },
                { nombre: "Fundamentos of la IA", indicadores: ["Reconocer los fundamentos of la inteligencia artificial, identificando c√≥mo funciona y se diferencia of otros sistemas digitales."] },
                { nombre: "Herramientas generativas", indicadores: ["Utilizar herramientas generativas basadas en inteligencia artificial, aplicando funciones para la creation o modificaci√≥n of contenido digital."] }
              ]
            }
          },
          "9¬∞": {
            "Apropiaci√≥n tecnol√≥gica y Digital": {
              saberes: [
                { nombre: "Redes of comunicaci√≥n", indicadores: ["Reconocer las redes of comunicaci√≥n a partir of su arquitectura, protocolos (como HTTP, HTTPS y TCP/IP) e interfaces."] },
                { nombre: "Sistema Operativo", indicadores: ["Aplicar t√©cnicas of optimizaci√≥n del sistema operativo, identificando c√≥mo gestionar memoria, desfragmentar discos, limpiar cach√© y actualizar el sistema para el mejoramiento del desempe√±o of dispositivos."] },
                { nombre: "Herramienta of productividad (Gestor of bases of datos)", indicadores: ["Utilizar un gestor of bases of datos como herramienta of productividad para la creation of tablas, estableciendo relaciones entre ellas y realizando consultas."] },
                { nombre: "Herramientas of creation of contenido multimedia", indicadores: ["Utilizar herramientas of creation of contenido multimedia para el modelado 3D."] },
                { nombre: "Plataformas of creation of contenido", indicadores: ["Crear encuestas o formularios mediante plataformas of creation of contenido, ajustando su formato y estructura al prop√≥sito of recolecci√≥n o evaluaci√≥n of datos."] },
                { nombre: "Derechos of autor y licenciamiento", indicadores: ["Reconocer la importancia of los derechos of autor y el licenciamiento, aplicando buenas pr√°cticas of uso √©tico y legal."] },
                { nombre: "Huella digital", indicadores: ["Analizar la utilidad e implicaciones of la huella digital, valorando c√≥mo las acciones en l√≠nea afectan la identidad, reputaci√≥n y seguridad."] },
                { nombre: "Riesgos en l√≠nea", indicadores: ["Analizar riesgos en l√≠nea (acceso a informaci√≥n inapropiada, ciberadicci√≥n, ciberacoso y el sexting)."] }
              ]
            },
            "Programaci√≥n y Algoritmos": {
              saberes: [
                { nombre: "Entorno of programaci√≥n textual o bloques para programar mecanismos rob√≥ticos", indicadores: ["Dise√±ar soluciones automatizadas en un entorno of programaci√≥n textual o por bloques para programar mecanismos rob√≥ticos."] },
                { nombre: "Algoritmo", indicadores: ["Dise√±ar un algoritmo para resolver un problema, represent√°ndolo of forma estructurada mediante pseudoc√≥digo o diagrama of flujo."] }
              ]
            },
            "Computaci√≥n f√≠sica y Rob√≥tica": {
              saberes: [
                { nombre: "Movimiento en mecanismos", indicadores: ["Identificar el movimiento en mecanismos rob√≥ticos, diferenciando el movimiento of entrada y salida."] },
                { nombre: "Microcontrolador", indicadores: ["Aplicar las funciones of un microcontrolador, utilizando pines digitales y anal√≥gicos, conexi√≥n a VCC y GND."] },
                { nombre: "Sensor", indicadores: ["Integrar un sensor en un prototipo, utilizando sus datos como entrada para generar respuestas automatizadas."] },
                { nombre: "Actuador", indicadores: ["Integrar un actuador en un prototipo, programando su activaci√≥n como respuesta a entradas digitales o condiciones del sistema."] },
                { nombre: "Dom√≥tica", indicadores: ["Analizar los usos, aplicaciones y beneficios of la dom√≥tica, mediante la creation o simulaci√≥n of un prototipo."] },
                { nombre: "Prototipos", indicadores: ["Construir prototipos que integren sensores, actuadores y un microcontrolador, a partir of una necesidad identificada."] }
              ]
            },
            "Ciencia of datos e Inteligencia artificial": {
              saberes: [
                { nombre: "Dato", indicadores: ["Reconocer la importancia of la organizaci√≥n y conservaci√≥n del dato, aplicando criterios of seguridad y responsabilidad."] },
                { nombre: "Almacenamiento of datos", indicadores: ["Reconocer el ciclo of vida del dato en el almacenamiento of datos, identificando las etapas of creation, uso, conservaci√≥n y eliminaci√≥n responsable."] },
                { nombre: "Herramientas generativas", indicadores: ["Aplicar herramientas generativas con inteligencia artificial en la producci√≥n of contenido digital, considerando criterios of seguridad, propiedad intelectual y responsabilidad digital."] },
                { nombre: "Desaf√≠os of la IA", indicadores: ["Reconocer los desaf√≠os of la inteligencia artificial, identificando riesgos como sesgos, manipulaci√≥n of informaci√≥n, dependencia tecnol√≥gica y privacidad of datos, reflexionando sobre su impacto en la vida laboral, personal y social."] }
              ]
            }
          }
        };

        // ===== RESULTADOS DE APRENDIZAJE (RdA) POR CICLO Y √ÅREA =====
        const RDA_POR_CICLO = {
          "Materno Infantil/Transici√≥n": {
            "Apropiaci√≥n tecnol√≥gica y Digital": "Identifica los dispositivos digitales considerando caracter√≠sticas funcionales, experimentando su utilidad y reconociendo la autor√≠a, durante la accesibilidad, interacci√≥n y comunicaci√≥n en la creaci√≥n de recursos digitales.",
            "Programaci√≥n y Algoritmos": "Ordena secuencias integrando conceptos de programaci√≥n como dato, evento, estado, ciclos, as√≠ como nociones de lateralidad y orientaci√≥n espacial, en la soluci√≥n de desaf√≠os propuestos, utilizando la programaci√≥n iconogr√°fica por bloques.",
            "Computaci√≥n f√≠sica y Rob√≥tica": "Reconoce el funcionamiento de los robots, as√≠ como sus componentes (cuerpo, sistema sensorial, sistemas de control), al clasificarlos por su uso y programarlos para resolver retos.",
            "Ciencia de datos e Inteligencia artificial": "Reconoce los conceptos b√°sicos relacionados con la recopilaci√≥n, organizaci√≥n e interpretaci√≥n de datos, mediante gr√°ficos pict√≥ricos en la resoluci√≥n de problemas, fomentando el pensamiento cr√≠tico y la curiosidad hacia el mundo que lo rodea."
          },
          "I Ciclo": {
            "Apropiaci√≥n tecnol√≥gica y Digital": "Selecciona los dispositivos digitales y herramientas de productividad, mediante el uso de software y hardware, en la creaci√≥n de archivos, creaci√≥n y edici√≥n de contenido multimedia, aprovechando Internet y respetando la propiedad intelectual en la realizaci√≥n de tareas para la accesibilidad a la informaci√≥n de forma segura y responsable.",
            "Programaci√≥n y Algoritmos": "Selecciona conceptos de programaci√≥n como dato, secuencia, evento, estado, variables, operadores aritm√©ticos y relacionales, condicionales simples, ciclo finito e infinito, en la programaci√≥n por bloques para la solution de problemas.",
            "Computaci√≥n f√≠sica y Rob√≥tica": "No aplica para este ciclo.",
            "Ciencia de datos e Inteligencia artificial": "Reconoce los fundamentos de la inteligencia artificial y su presencia en la vida cotidiana, mediante ejemplos concretos como asistentes virtuales, valorando el uso seguro y responsable de estas tecnolog√≠as."
          },
          "II Ciclo": {
            "Apropiaci√≥n tecnol√≥gica y Digital": "Selecciona la configuraci√≥n de programas locales y en l√≠nea para su correcto uso al crear, buscar, compartir, organizar y administrar informaci√≥n en la realizaci√≥n de diferentes tareas de manera comprensiva, segura y responsable.",
            "Programaci√≥n y Algoritmos": "Crea algoritmos que integran los conceptos de programaci√≥n como secuencia, evento, estructuras de control (condicionales simples y ciclos), en la soluci√≥n a problemas del contexto mediante la programaci√≥n por bloques.",
            "Computaci√≥n f√≠sica y Rob√≥tica": "Crea algoritmos que permiten la simulaci√≥n de comportamientos de aparatos tecnol√≥gicos, aplicando elementos de computaci√≥n f√≠sica, programaci√≥n y electr√≥nica para la resoluci√≥n de un problema.",
            "Ciencia de datos e Inteligencia artificial": "Reconoce el uso de la inteligencia artificial en contextos cotidianos y aplica t√©cnicas b√°sicas de recolecci√≥n, an√°lisis y representaci√≥n de datos mediante tablas y gr√°ficos."
          },
          "III Ciclo": {
            "Apropiaci√≥n tecnol√≥gica y Digital": "Combina herramientas digitales, tomando en cuenta fundamentos de tecnolog√≠a, impacto de las TIC, seguridad y privacidad digital y su experiencia de uso, en la realizaci√≥n de productos digitales.",
            "Programaci√≥n y Algoritmos": "Integra conceptos de programaci√≥n como eventos, operadores, estructuras de datos, estructuras de control, procedimientos, funciones, colecciones de datos y algoritmos (diagrama de flujo y pseudoc√≥digo), en la soluci√≥n de problemas reales.",
            "Computaci√≥n f√≠sica y Rob√≥tica": "Aplica fundamentos de rob√≥tica, computaci√≥n f√≠sica, electr√≥nica, mec√°nica y sistemas rob√≥ticos aut√≥nomos en la programaci√≥n y construcci√≥n de prototipos que resuelven un problema.",
            "Ciencia de datos e Inteligencia artificial": "Analiza datos mediante herramientas digitales que permiten su visualizaci√≥n para la toma de decisiones en situaciones cotidianas y reconoce aspectos fundamentales de la inteligencia artificial, incluyendo sus aplicaciones actuales y desaf√≠os asociados."
          }
        };

        // Variables globales - SOLO UNA DECLARACI√ìN DE formatoExportacion
        let semanas = [];
        let saberesSeleccionados = new Set();
        let saberesProcedimentalesGlobales = new Set();
        let saberesActitudinalesGlobales = new Set();
        let formatoExportacion = 'word'; // ‚Üê Declaraci√≥n √öNICA y correcta

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSemanas();
            configurarEventListeners();
        });

        function configurarEventListeners() {
            document.getElementById('leccionesPlanificadas').addEventListener('change', actualizarSemanasPreservandoContenido);
        }

        function actualizarNiveles() {
            const ciclo = document.getElementById('ciclo').value;
            const nivelSelect = document.getElementById('nivel');
            
            nivelSelect.innerHTML = '<option value="">Seleccione nivel</option>';
            
            if (ciclo === 'Materno Infantil/Transici√≥n') {
                nivelSelect.innerHTML += '<option value="Grupo Interactivo II y Transici√≥n">Grupo Interactivo II y Transici√≥n</option>';
            } else if (ciclo === 'I Ciclo') {
                nivelSelect.innerHTML += '<option value="1¬∞">1¬∞</option>';
                nivelSelect.innerHTML += '<option value="2¬∞">2¬∞</option>';
                nivelSelect.innerHTML += '<option value="3¬∞">3¬∞</option>';
            } else if (ciclo === 'II Ciclo') {
                nivelSelect.innerHTML += '<option value="4¬∞">4¬∞</option>';
                nivelSelect.innerHTML += '<option value="5¬∞">5¬∞</option>';
                nivelSelect.innerHTML += '<option value="6¬∞">6¬∞</option>';
            } else if (ciclo === 'III Ciclo') {
                nivelSelect.innerHTML += '<option value="7¬∞">7¬∞</option>';
                nivelSelect.innerHTML += '<option value="8¬∞">8¬∞</option>';
                nivelSelect.innerHTML += '<option value="9¬∞">9¬∞</option>';
            }
        }

        function inicializarSemanas() {
            const lecciones = parseInt(document.getElementById('leccionesPlanificadas').value) || 8;
            const numSemanas = Math.ceil(lecciones / 2);
            
            semanas = [];
            const container = document.getElementById('semanasContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= numSemanas; i++) {
                const leccionInicio = (i - 1) * 2 + 1;
                const leccionFin = Math.min(i * 2, lecciones);
                
                semanas.push({
                    id: i,
                    nombre: `Semana ${i}`,
                    lecciones: `Lecciones ${leccionInicio} y ${leccionFin}`,
                    areas: [],
                    rda: '',
                    saberes: [],
                    procedimentales: [],
                    actitudinales: [],
                    actividades: '',
                    recursos: '',
                    evaluacion: '',
                    indicadores: ''
                });
                
                const semanaElement = crearElementoSemana(i, leccionInicio, leccionFin);
                container.appendChild(semanaElement);
            }
            
            actualizarContadoresSemanas();
        }

        function actualizarSemanasPreservandoContenido() {
            const leccionesActual = parseInt(document.getElementById('leccionesPlanificadas').value) || 8;
            const numSemanasNecesarias = Math.ceil(leccionesActual / 2);
            
            console.log(`Actualizando semanas: ${semanas.length} ‚Üí ${numSemanasNecesarias}`);
            
            // PRESERVAR datos existentes completamente
            const semanasBackup = JSON.parse(JSON.stringify(semanas));
            const saberesBackup = new Set(saberesSeleccionados);
            const procBackup = new Set(saberesProcedimentalesGlobales);
            const actBackup = new Set(saberesActitudinalesGlobales);
            
            // Solo preguntar si estamos reduciendo semanas
            if (semanas.length > numSemanasNecesarias) {
                if (!confirm(`Al reducir las lecciones se eliminar√°n ${semanas.length - numSemanasNecesarias} semana(s) y su contenido. ¬øDesea continuar?`)) {
                    document.getElementById('leccionesPlanificadas').value = semanas.length * 2;
                    return;
                }
            }
            
            semanas = [];
            const container = document.getElementById('semanasContainer');
            container.innerHTML = '';
            
            for (let i = 1; i <= numSemanasNecesarias; i++) {
                const leccionInicio = (i - 1) * 2 + 1;
                const leccionFin = Math.min(i * 2, leccionesActual);
                
                // PRESERVAR datos de la semana si existe en el backup
                const semanaBackup = semanasBackup[i-1];
                
                semanas.push({
                    id: i,
                    nombre: `Semana ${i}`,
                    lecciones: `Lecciones ${leccionInicio} y ${leccionFin}`,
                    areas: semanaBackup ? semanaBackup.areas : [],
                    rda: semanaBackup ? semanaBackup.rda : '',
                    saberes: semanaBackup ? semanaBackup.saberes : [],
                    procedimentales: semanaBackup ? semanaBackup.procedimentales : [],
                    actitudinales: semanaBackup ? semanaBackup.actitudinales : [],
                    actividades: semanaBackup ? semanaBackup.actividades : '',
                    recursos: semanaBackup ? semanaBackup.recursos : '',
                    evaluacion: semanaBackup ? semanaBackup.evaluacion : '',
                    indicadores: semanaBackup ? semanaBackup.indicadores : ''
                });
                
                const semanaElement = crearElementoSemana(i, leccionInicio, leccionFin);
                container.appendChild(semanaElement);
            }
            
            // RESTAURAR datos globales
            saberesSeleccionados = new Set(saberesBackup);
            saberesProcedimentalesGlobales = new Set(procBackup);
            saberesActitudinalesGlobales = new Set(actBackup);
            
            // ACTUALIZAR interfaz preservando todo el contenido
            setTimeout(() => {
                reconstruirVistaSemanasPreservandoContenido();
                actualizarContadoresSemanas();
            }, 100);
        }

        function crearElementoSemana(numero, leccionInicio, leccionFin) {
            const semanaDiv = document.createElement('div');
            semanaDiv.className = 'semana-item';
            semanaDiv.id = `semana-${numero}`;
            
            semanaDiv.innerHTML = `
                <div class="semana-header">
                    <div>
                        <strong>Semana ${numero}</strong>
                    </div>
                    <div>
                        <input type="text" class="semana-nombre input-field" value="Lecciones ${leccionInicio} y ${leccionFin}" 
                               onchange="actualizarLeccionesSemana(${numero}, this.value)">
                        <span style="font-size: 10px; color: #666; margin-left: 6px;">(${leccionInicio}-${leccionFin})</span>
                    </div>
                    <button type="button" class="btn-eliminar-semana" onclick="eliminarSemana(${numero})" 
                            ${semanas.length <= 1 ? 'disabled' : ''}>‚úï</button>
                </div>
                
                <!-- √ÅREAS DE CONOCIMIENTO Y RDA EN PARALELO -->
                <div class="areas-rda-container">
                    <div class="areas-container">
                        <div class="section-title">√Åreas de conocimiento para esta semana</div>
                        <div class="areas-lista">
                            <div class="area-item">
                                <input type="checkbox" name="area-semana-${numero}" value="apropiacion" onchange="actualizarAreaSemana(${numero}, this)">
                                <span>Apropiaci√≥n Tecnol√≥gica y Digital</span>
                            </div>
                            <div class="area-item">
                                <input type="checkbox" name="area-semana-${numero}" value="programacion" onchange="actualizarAreaSemana(${numero}, this)">
                                <span>Programaci√≥n y Algoritmos</span>
                            </div>
                            <div class="area-item">
                                <input type="checkbox" name="area-semana-${numero}" value="robotica" onchange="actualizarAreaSemana(${numero}, this)">
                                <span>Computaci√≥n f√≠sica y Rob√≥tica</span>
                            </div>
                            <div class="area-item">
                                <input type="checkbox" name="area-semana-${numero}" value="ciencia" onchange="actualizarAreaSemana(${numero}, this)">
                                <span>Ciencia de datos e Inteligencia artificial</span>
                            </div>
                        </div>
                    </div>
                    <div class="rda-container">
                        <div class="section-title">Resultados de aprendizaje (RdA)</div>
                        <div id="rda-semana-${numero}">
                            <div style="color: #666; font-style: italic; padding: 8px; font-size: 11px;">Seleccione al menos un √°rea de conocimiento</div>
                        </div>
                    </div>
                </div>
                
                <!-- SABERES 2x3 -->
                <div class="section-title">Saberes por Desarrollo</div>
                <div class="saberes-grid">
                    <div class="saber-columna">
                        <div class="saber-titulo">Saberes Conceptuales (Saber)</div>
                        <div class="saber-contenido" id="conceptuales-semana-${numero}">
                            <div style="color: #666; font-style: italic; font-size: 11px;">‚ÄúLos saberes conceptuales se mostrar√°n autom√°ticamente seg√∫n las √°reas seleccionadas, junto con aquellos que elijas espec√≠ficamente para esta semana en el espacio correspondiente.‚Äù</div>
                        </div>
                    </div>
                    <div class="saber-columna">
                        <div class="saber-titulo">Saberes Procedimentales (Saber Hacer)</div>
                        <div class="saber-contenido">
                            ${generarOpcionesProcedimentales(numero)}
                        </div>
                    </div>
                    <div class="saber-columna">
                        <div class="saber-titulo">Saberes Actitudinales (Saber Ser)</div>
                        <div class="saber-contenido">
                            ${generarOpcionesActitudinales(numero)}
                        </div>
                    </div>
                </div>
                
                <!-- SABERES CONCEPTUALES PARA ESTA SEMANA -->
                <div class="section-title">Saberes conceptuales para esta semana</div>
                <div class="saberes-conceptuales-container" id="saberes-conceptuales-${numero}">
                    <div style="color: #666; font-style: italic; font-size: 11px;">Seleccione ciclo, nivel y √°reas de conocimiento para ver los saberes disponibles</div>
                </div>
                
                <!-- 3 COLUMNAS INFERIORES -->
                <div class="tres-columnas">
                    <div class="campo-editable">
                        <div class="columna-titulo">Indicadores de logro</div>
                        <div class="contenedor-editable" contenteditable="true" 
                             data-placeholder="Los indicadores aparecer√°n autom√°ticamente seg√∫n los saberes conceptuales seleccionados..." 
                             oninput="actualizarContenidoSemana(${numero}, 'indicadores', this.innerHTML)"></div>
                    </div>
                    <div class="campo-editable">
                        <div class="columna-titulo">Estrategias de <strong>Mediaci√≥n </strong> </div>
                        <div class="contenedor-editable" contenteditable="true" 
                             data-placeholder="Describa las estrategias de *Mediaci√≥n*...(Recuerde vincular los saberes procedimentales y actitudinales en las actividades)" 
                             oninput="actualizarContenidoSemana(${numero}, 'actividades', this.innerHTML)"></div>
                    </div>
                    <div class="campo-editable">
                        <div class="columna-titulo">Indicadores de evaluaci√≥n</div>
                        <div class="contenedor-editable" contenteditable="true" 
                             data-placeholder="Describa los indicadores de evaluaci√≥n..." 
                             oninput="actualizarContenidoSemana(${numero}, 'evaluacion', this.innerHTML)"></div>
                    </div>
                </div>
                
                <!-- BOT√ìN PROMPT IA -->
                <div style="text-align: center; margin-top: 12px;">
                    <button onclick="generarPromptSemana(${numero})" class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;">ü§ñ Prompt IA para Semana ${numero}</button>
                </div>
            `;
            
            return semanaDiv;
        }

        function generarOpcionesProcedimentales(numeroSemana) {
            const procedimentales = [
                { value: "reconoce", label: "Reconoce patrones", tooltip: "Predice a partir de las regularidades, similitudes o caracter√≠sticas comunes de un conjunto de datos o situaciones, patrones que pueda aplicar en la soluci√≥n a un problema o situaci√≥n." },
                { value: "abstrae", label: "Abstrae", tooltip: "Concluye cu√°les son las caracter√≠sticas relevantes que debe considerar y cu√°les debe omitir al resolver un problema o situaci√≥n." },
                { value: "generaliza", label: "Generaliza", tooltip: "Generaliza las funcionalidades o estructuras generales de un elemento que pueda aprovechar en otros contextos al resolver un problema o situaci√≥n." },
                { value: "transfiere", label: "Transfiere", tooltip: "Transfiere conocimientos, habilidades y estrategias aprendidas previamente en un contexto espec√≠fico, a situaciones diferentes y nuevas al resolver un problema o situaci√≥n." },
                { value: "modulariza", label: "Modulariza", tooltip: "Resuelve un problema por partes menos complejas, sin perder de vista el todo que las origina, al resolver un problema o situaci√≥n." },
                { value: "formula", label: "Formula algoritmos", tooltip: "Formula algoritmos por medio de una secuencia ordenada y detallada de pasos para resolver un problema o situaci√≥n." },
                { value: "remezcla", label: "Remezcla", tooltip: "Combina diferentes ideas, t√©cnicas o soluciones existentes, con la autorizaci√≥n correspondiente, de manera innovadora y creativa para resolver un problema o situaci√≥n." },
                { value: "depura", label: "Depura", tooltip: "Valida el funcionamiento de los algoritmos en busca de errores para corregirlos, al resolver un problema o situaci√≥n." },
                { value: "programa", label: "Programa", tooltip: "Programa mediante un entorno o IDE de programaci√≥n para resolver un problema o situaci√≥n." },
                { value: "comunica", label: "Comunica", tooltip: "Comunica ideas o soluciones a problemas o situaciones de manera creativa, coherente y comprensible, compartiendo conocimientos con otros al resolver un problema o situaci√≥n." },
                { value: "colabora", label: "Colabora", tooltip: "Demuestra un trato constructivo y respetuoso para resolver un problema o situaci√≥n espec√≠fica, al trabajar con otros y as√≠ apoyar su aprendizaje y contribuir al de los dem√°s, al resolver un problema o situaci√≥n." },
                { value: "piensa", label: "Piensa de forma creativa", tooltip: "Desarrolla soluciones ingeniosas, innovadoras, originales con enfoques no convencionales, al resolver un problema o situaci√≥n." },
                { value: "maneja", label: "Maneja las tecnolog√≠as de forma √©tica y segura", tooltip: "Aplica de manera consciente fundamentos de √©tica y seguridad digital al utilizar herramientas y recursos tecnol√≥gicos, al resolver un problema o situaci√≥n." }
            ];
            
            return procedimentales.map(proc => `
                <div style="margin-bottom: 6px;">
                    <label class="tooltip-improved">
                        <input type="checkbox" name="procedimental-semana-${numeroSemana}" value="${proc.value}" onchange="actualizarProcedimentalSemana(${numeroSemana}, this)">
                        <span style="font-size: 11px;">${proc.label}</span>
                        <span class="tooltiptext-improved">${proc.tooltip}</span>
                    </label>
                </div>
            `).join('');
        }

        function generarOpcionesActitudinales(numeroSemana) {
            const actitudinales = [
                { value: "gusto", label: "Gusto por la precisi√≥n", tooltip: "Demuestra ante los procesos de aprendizaje un comportamiento hacia la b√∫squeda de la exactitud, al ser minucioso con los detalles." },
                { value: "aprender", label: "Aprender del error", tooltip: "Demuestra ante los errores un comportamiento que le permita ganar experiencia a partir de lecciones aprendidas producto de los errores, convirtiendo los desaciertos en oportunidades de aprendizaje." },
                { value: "flexibilidad", label: "Flexibilidad para manejar problemas", tooltip: "Demuestra un comportamiento hacia la adaptabilidad, flexibilidad y resiliencia ante los desaf√≠os o situaciones imprevistas producto del entorno, la interacci√≥n con otros, o bien, con los recursos." },
                { value: "tolerancia", label: "Tolerancia a la frustraci√≥n", tooltip: "Demuestra ante los desaf√≠os, un comportamiento hacia la b√∫squeda de la autoconfianza, motivaci√≥n, autocontrol, paciencia y persistencia." }
            ];
            
            return actitudinales.map(act => `
                <div style="margin-bottom: 6px;">
                    <label class="tooltip-improved">
                        <input type="checkbox" name="actitudinal-semana-${numeroSemana}" value="${act.value}" onchange="actualizarActitudinalSemana(${numeroSemana}, this)">
                        <span style="font-size: 11px;">${act.label}</span>
                        <span class="tooltiptext-improved">${act.tooltip}</span>
                    </label>
                </div>
            `).join('');
        }

        function actualizarAreaSemana(numeroSemana, checkbox) {
            const semana = semanas[numeroSemana-1];
            const areaMapping = {
                'apropiacion': 'Apropiaci√≥n tecnol√≥gica y Digital',
                'programacion': 'Programaci√≥n y Algoritmos',
                'robotica': 'Computaci√≥n f√≠sica y Rob√≥tica',
                'ciencia': 'Ciencia de datos e Inteligencia artificial'
            };
            
            const areaNombre = areaMapping[checkbox.value];
            
            if (checkbox.checked) {
                if (!semana.areas.includes(areaNombre)) {
                    semana.areas.push(areaNombre);
                }
            } else {
                semana.areas = semana.areas.filter(a => a !== areaNombre);
                // Limpiar saberes de esta √°rea
                semana.saberes = semana.saberes.filter(saber => {
                    const saberData = Object.values(PNFT_DATA[document.getElementById('nivel').value] || {})
                        .find(area => area.saberes.find(s => s.nombre === saber));
                    return !saberData || saberData.saberes.find(s => s.nombre === saber);
                });
            }
            
            // ‚úÖ ESTAS TRES L√çNEAS SON LAS QUE ACTUALIZAN LA INTERFAZ
            actualizarRdASemana(numeroSemana);
            actualizarOpcionesSaberesSemana(numeroSemana); 
            actualizarIndicadoresSemana(numeroSemana);
        }

        function actualizarRdASemana(numeroSemana) {
            const semana = semanas[numeroSemana-1];
            const ciclo = document.getElementById('ciclo').value;
            const rdaContainer = document.getElementById(`rda-semana-${numeroSemana}`);
            
            rdaContainer.innerHTML = '';
            
            if (!ciclo || semana.areas.length === 0) {
                rdaContainer.innerHTML = '<div style="color: #666; font-style: italic; padding: 8px; font-size: 11px;">Seleccione al menos un √°rea de conocimiento</div>';
                return;
            }
            
            semana.areas.forEach(areaNombre => {
                if (RDA_POR_CICLO[ciclo] && RDA_POR_CICLO[ciclo][areaNombre]) {
                    const rdaItem = document.createElement('div');
                    rdaItem.className = 'rda-item';
                    rdaItem.innerHTML = `<strong>${areaNombre}:</strong><br>${RDA_POR_CICLO[ciclo][areaNombre]}`;
                    rdaContainer.appendChild(rdaItem);
                }
            });
        }

        function actualizarOpcionesSaberesSemana(numeroSemana) {
            const container = document.getElementById(`saberes-conceptuales-${numeroSemana}`);
            container.innerHTML = generarSaberesConceptuales(numeroSemana);
            
            // ACTUALIZAR TAMBI√âN EL CONTENEDOR DE SABERES CONCEPTUALES EN LA PARTE SUPERIOR
            actualizarSaberesConceptualesContenedor(numeroSemana);
        }

        function generarSaberesConceptuales(numeroSemana) {
            const semana = semanas[numeroSemana-1];
            const nivel = document.getElementById('nivel').value;
            
            if (!nivel || semana.areas.length === 0) {
                return '<div style="color: #666; font-style: italic; font-size: 11px;">Seleccione ciclo, nivel y al menos un √°rea de conocimiento</div>';
            }
            
            let html = '';
            
            // Mostrar solo los saberes de las √°reas seleccionadas
            semana.areas.forEach(areaNombre => {
                if (PNFT_DATA[nivel] && PNFT_DATA[nivel][areaNombre]) {
                    html += `<div style="margin-bottom: 12px;">`;
                    html += `<div style="font-weight: 600; color: var(--primary-color); margin-bottom: 6px; border-bottom: 1px solid var(--light-purple); padding-bottom: 4px; font-size: 12px;">${areaNombre}</div>`;
                    
                    PNFT_DATA[nivel][areaNombre].saberes.forEach(saber => {
                        const estaSeleccionado = semana.saberes.includes(saber.nombre);
                        
                        html += `
                            <div class="saber-conceptual-item ${estaSeleccionado ? 'seleccionado' : ''}">
                                <input type="checkbox" 
                                       ${estaSeleccionado ? 'checked' : ''}
                                       onchange="manejarSeleccionSaber(${numeroSemana}, '${saber.nombre}', this.checked, '${areaNombre}', \`${saber.indicadores.join('|')}\`)">
                                <div style="flex: 1;">
                                    <div style="font-weight: 500; font-size: 11px;">${saber.nombre}</div>
                                    <div class="indicador-logro">${saber.indicadores[0]}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
            });
            
            return html || '<div style="color: #666; font-style: italic; font-size: 11px;">No hay saberes disponibles para las √°reas seleccionadas</div>';
        }

        function actualizarSaberesConceptualesContenedor(numeroSemana) {
            const semana = semanas[numeroSemana-1];
            const contenedor = document.getElementById(`conceptuales-semana-${numeroSemana}`);
            
            if (semana.saberes.length === 0) {
                contenedor.innerHTML = '<div style="color: #666; font-style: italic; font-size: 11px;">"Los saberes conceptuales se mostrar√°n autom√°ticamente seg√∫n las √°reas seleccionadas, junto con aquellos que elijas espec√≠ficamente para esta semana en el espacio correspondiente."</div>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 6px;">';
            
            semana.saberes.forEach(saber => {
                html += `
                    <div style="padding: 6px; background: var(--light-purple); border-radius: 6px; border-left: 3px solid var(--primary-color);">
                        <div style="font-weight: 500; font-size: 11px;">${saber}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            contenedor.innerHTML = html;
        }

        function manejarSeleccionSaber(numeroSemana, nombreSaber, seleccionado, area, indicadoresStr) {
            const semana = semanas[numeroSemana-1];
            const indicadores = indicadoresStr.split('|');
            
            if (seleccionado) {
                if (!semana.saberes.includes(nombreSaber)) {
                    semana.saberes.push(nombreSaber);
                    saberesSeleccionados.add(nombreSaber);
                }
            } else {
                semana.saberes = semana.saberes.filter(s => s !== nombreSaber);
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numeroSemana-1 && s.saberes.includes(nombreSaber)
                );
                if (!enOtraSemana) {
                    saberesSeleccionados.delete(nombreSaber);
                }
            }
            
            // Actualizar la clase de selecci√≥n visual
            const checkboxes = document.querySelectorAll(`#saberes-conceptuales-${numeroSemana} input[type="checkbox"]`);
            checkboxes.forEach(checkbox => {
                if (checkbox.nextElementSibling?.querySelector('div')?.textContent === nombreSaber) {
                    checkbox.parentElement.classList.toggle('seleccionado', seleccionado);
                }
            });
            
            // ACTUALIZAR EL CONTENEDOR DE SABERES CONCEPTUALES
            actualizarSaberesConceptualesContenedor(numeroSemana);
            actualizarIndicadoresSemana(numeroSemana);
        }

        function actualizarIndicadoresSemana(numeroSemana) {
            const semana = semanas[numeroSemana-1];
            const indicadoresContainer = document.querySelector(`#semana-${numeroSemana} .contenedor-editable[data-placeholder*="indicadores"]`);
            
            if (!indicadoresContainer) return;
            
            let indicadoresHTML = '';
            semana.saberes.forEach(saber => {
                const saberData = Object.values(PNFT_DATA[document.getElementById('nivel').value] || {})
                    .find(area => area.saberes.find(s => s.nombre === saber));
                if (saberData) {
                    const saberInfo = saberData.saberes.find(s => s.nombre === saber);
                    if (saberInfo) {
                        saberInfo.indicadores.forEach(indicador => {
                            indicadoresHTML += `<div style="margin-bottom: 6px; padding: 4px 0; border-bottom: 1px dotted #ddd; font-size: 11px;">‚Ä¢ ${indicador}</div>`;
                        });
                    }
                }
            });
            
            indicadoresContainer.innerHTML = indicadoresHTML || '<div style="color: #666; font-style: italic; font-size: 11px;">Los indicadores aparecer√°n autom√°ticamente seg√∫n los saberes conceptuales seleccionados...</div>';
            semanas[numeroSemana-1].indicadores = indicadoresHTML;
        }

        function actualizarProcedimentalSemana(numeroSemana, checkbox) {
            const semana = semanas[numeroSemana-1];
            
            if (checkbox.checked) {
                if (!semana.procedimentales.includes(checkbox.value)) {
                    semana.procedimentales.push(checkbox.value);
                    saberesProcedimentalesGlobales.add(checkbox.value);
                }
            } else {
                semana.procedimentales = semana.procedimentales.filter(p => p !== checkbox.value);
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numeroSemana-1 && s.procedimentales.includes(checkbox.value)
                );
                if (!enOtraSemana) {
                    saberesProcedimentalesGlobales.delete(checkbox.value);
                }
            }
        }

        function actualizarActitudinalSemana(numeroSemana, checkbox) {
            const semana = semanas[numeroSemana-1];
            
            if (checkbox.checked) {
                if (!semana.actitudinales.includes(checkbox.value)) {
                    semana.actitudinales.push(checkbox.value);
                    saberesActitudinalesGlobales.add(checkbox.value);
                }
            } else {
                semana.actitudinales = semana.actitudinales.filter(a => a !== checkbox.value);
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numeroSemana-1 && s.actitudinales.includes(checkbox.value)
                );
                if (!enOtraSemana) {
                    saberesActitudinalesGlobales.delete(checkbox.value);
                }
            }
        }

        function actualizarLeccionesSemana(numero, nuevoNombre) {
            semanas[numero-1].lecciones = nuevoNombre;
        }

        function actualizarContenidoSemana(numero, tipo, contenido) {
            semanas[numero-1][tipo] = contenido;
        }

        function agregarSemanaManual() {
            const leccionesActual = parseInt(document.getElementById('leccionesPlanificadas').value) || 8;
            const nuevoNumero = semanas.length + 1;
            const leccionInicio = leccionesActual + 1;
            const leccionFin = leccionInicio + 1;
            
            // Actualizar lecciones planificadas
            document.getElementById('leccionesPlanificadas').value = leccionFin;
            
            semanas.push({
                id: nuevoNumero,
                nombre: `Semana ${nuevoNumero}`,
                lecciones: `Lecciones ${leccionInicio} y ${leccionFin}`,
                areas: [],
                rda: '',
                saberes: [],
                procedimentales: [],
                actitudinales: [],
                actividades: '',
                recursos: '',
                evaluacion: '',
                indicadores: ''
            });
            
            const container = document.getElementById('semanasContainer');
            const nuevaSemana = crearElementoSemana(nuevoNumero, leccionInicio, leccionFin);
            container.appendChild(nuevaSemana);
            
            actualizarContadoresSemanas();
        }

        function eliminarSemana(numero) {
            if (semanas.length <= 1) {
                alert('Debe haber al menos una semana');
                return;
            }
            
            if (!confirm('¬øEst√° seguro de que desea eliminar esta semana? Se perder√° todo el contenido de esta semana.')) {
                return;
            }
            
            const semanaAEliminar = semanas[numero-1];
            
            // SOLO eliminar los datos de ESTA semana espec√≠fica
            semanaAEliminar.saberes.forEach(saber => {
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numero-1 && s.saberes.includes(saber)
                );
                if (!enOtraSemana) {
                    saberesSeleccionados.delete(saber);
                }
            });
            
            semanaAEliminar.procedimentales.forEach(proc => {
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numero-1 && s.procedimentales.includes(proc)
                );
                if (!enOtraSemana) {
                    saberesProcedimentalesGlobales.delete(proc);
                }
            });
            
            semanaAEliminar.actitudinales.forEach(act => {
                const enOtraSemana = semanas.some((s, index) => 
                    index !== numero-1 && s.actitudinales.includes(act)
                );
                if (!enOtraSemana) {
                    saberesActitudinalesGlobales.delete(act);
                }
            });
            
            // Eliminar solo la semana espec√≠fica
            semanas.splice(numero-1, 1);
            
            // Reconstruir vista SIN afectar otras semanas
            reconstruirVistaSemanasPreservandoContenido();
            actualizarContadoresSemanas();
            
            console.log(`Semana ${numero} eliminada. Semanas restantes: ${semanas.length}`);
        }

        function reconstruirVistaSemanasPreservandoContenido() {
            const container = document.getElementById('semanasContainer');
            container.innerHTML = '';
            
            semanas.forEach((semana, index) => {
                const lecciones = semana.lecciones.match(/\d+/g) || [];
                const leccionInicio = lecciones[0] ? parseInt(lecciones[0]) : (index * 2 + 1);
                const leccionFin = lecciones[1] ? parseInt(lecciones[1]) : Math.min((index + 1) * 2, parseInt(document.getElementById('leccionesPlanificadas').value));
                
                const semanaElement = crearElementoSemana(index + 1, leccionInicio, leccionFin);
                container.appendChild(semanaElement);
                
                // Restaurar TODO el estado de la semana
                setTimeout(() => {
                    // 1. PRIMERO restaurar √°reas seleccionadas (esto dispara actualizaciones autom√°ticas)
                    semana.areas.forEach(area => {
                        const areaMapping = {
                            'Apropiaci√≥n tecnol√≥gica y Digital': 'apropiacion',
                            'Programaci√≥n y Algoritmos': 'programacion',
                            'Computaci√≥n f√≠sica y Rob√≥tica': 'robotica',
                            'Ciencia de datos e Inteligencia artificial': 'ciencia'
                        };
                        
                        const areaKey = areaMapping[area];
                        if (areaKey) {
                            const checkbox = document.querySelector(`input[name="area-semana-${index+1}"][value="${areaKey}"]`);
                            if (checkbox) {
                                checkbox.checked = true;
                                // EJECUTAR MANUALMENTE la funci√≥n que se ejecutar√≠a al marcar el checkbox
                                actualizarAreaSemana(index + 1, checkbox);
                            }
                        }
                    });
                    
                    // 2. LUEGO restaurar saberes conceptuales seleccionados
                    semana.saberes.forEach(saber => {
                        const checkboxes = document.querySelectorAll(`#saberes-conceptuales-${index+1} input[type="checkbox"]`);
                        checkboxes.forEach(checkbox => {
                            const saberNombre = checkbox.nextElementSibling?.querySelector('div')?.textContent;
                            if (saberNombre === saber) {
                                checkbox.checked = true;
                                checkbox.parentElement.classList.add('seleccionado');
                            }
                        });
                    });
                    
                    // 3. RESTAURAR procedimentales
                    semana.procedimentales.forEach(proc => {
                        const checkbox = document.querySelector(`input[name="procedimental-semana-${index+1}"][value="${proc}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                    
                    // 4. RESTAURAR actitudinales  
                    semana.actitudinales.forEach(act => {
                        const checkbox = document.querySelector(`input[name="actitudinal-semana-${index+1}"][value="${act}"]`);
                        if (checkbox) checkbox.checked = true;
                    });
                    
                    // 5. RESTAURAR contenido de campos editables
                    const indicadoresContainer = document.querySelector(`#semana-${index+1} .contenedor-editable[data-placeholder*="indicadores"]`);
                    if (indicadoresContainer && semana.indicadores) {
                        indicadoresContainer.innerHTML = semana.indicadores;
                    }
                    
                    const actividadesContainer = document.querySelector(`#semana-${index+1} .contenedor-editable[data-placeholder*="estrategias"]`);
                    if (actividadesContainer && semana.actividades) {
                        actividadesContainer.innerHTML = semana.actividades;
                    }
                    
                    const evaluacionContainer = document.querySelector(`#semana-${index+1} .contenedor-editable[data-placeholder*="evaluaci√≥n"]`);
                    if (evaluacionContainer && semana.evaluacion) {
                        evaluacionContainer.innerHTML = semana.evaluacion;
                    }
                    
                }, 100);
            });
        }

        function actualizarContadoresSemanas() {
            document.getElementById('totalSemanas').textContent = semanas.length;
            document.getElementById('totalLecciones').textContent = document.getElementById('leccionesPlanificadas').value;
        }

        function mostrarDetalleMetodologia(metodologia) {
            document.querySelectorAll('.metodologia-detalle').forEach(detalle => {
                detalle.style.display = 'none';
            });
            
            if (metodologia === 'ABJ') {
                document.getElementById('detalleABJ').style.display = 'block';
            } else if (metodologia === 'ABR') {
                document.getElementById('detalleABR').style.display = 'block';
            } else if (metodologia === 'APD') {
                document.getElementById('detalleAPD').style.display = 'block';
            }
        }

        // Funciones para los botones de acci√≥n
        function nuevoPlan() {
            if (confirm('¬øEst√° seguro de que desea crear un nuevo plan? Se perder√°n los cambios no guardados.')) {
                location.reload();
            }
        }

        function abrirPlan() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const plan = JSON.parse(event.target.result);
                        cargarPlan(plan);
                    } catch (error) {
                        alert('Error al cargar el archivo: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function guardarPlan() {
            const plan = obtenerDatosPlan();
            const dataStr = JSON.stringify(plan, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const enlace = document.createElement('a');
            enlace.download = 'planeamiento-did√°ctico.json';
            enlace.href = URL.createObjectURL(dataBlob);
            enlace.click();
            
            setTimeout(() => URL.revokeObjectURL(enlace.href), 100);
        }

        function obtenerDatosPlan() {
            return {
                informacionGeneral: {
                    cursoLectivo: document.getElementById('cursoLectivo').value,
                    semestre: document.getElementById('semestre').value,
                    direccionRegional: document.getElementById('direccionRegional').value,
                    centroEducativo: document.getElementById('centroEducativo').value,
                    codigoCentro: document.getElementById('codigoCentro').value,
                    nombreDocente: document.getElementById('nombreDocente').value,
                    circuito: document.getElementById('circuito').value,
                    ciclo: document.getElementById('ciclo').value,
                    nivel: document.getElementById('nivel').value,
                    leccionesPlanificadas: document.getElementById('leccionesPlanificadas').value,
                    mesInicio: document.getElementById('mesInicio').value,
                    mesFinal: document.getElementById('mesFinal').value,
                    asignatura: document.getElementById('asignatura').value
                },
                ejesTransversales: Array.from(document.querySelectorAll('input[name="eje"]:checked')).map(cb => cb.value),
                metodologiaActiva: document.getElementById('metodologiaActiva').value,
                semanas: semanas,
                reflexiones: {
                    queFunciono: document.getElementById('queFunciono').value,
                    queNoFunciono: document.getElementById('queNoFunciono').value,
                    queMejorar: document.getElementById('queMejorar').value
                },
                observaciones: document.getElementById('observaciones').value,
                saberesGlobales: Array.from(saberesSeleccionados),
                saberesProcedimentalesGlobales: Array.from(saberesProcedimentalesGlobales),
                saberesActitudinalesGlobales: Array.from(saberesActitudinalesGlobales),
                fechaGuardado: new Date().toISOString()
            };
        }

        function cargarPlan(plan) {
            if (plan.informacionGeneral) {
                document.getElementById('cursoLectivo').value = plan.informacionGeneral.cursoLectivo || '2026';
                document.getElementById('semestre').value = plan.informacionGeneral.semestre || 'I';
                document.getElementById('direccionRegional').value = plan.informacionGeneral.direccionRegional || '';
                document.getElementById('centroEducativo').value = plan.informacionGeneral.centroEducativo || '';
                document.getElementById('codigoCentro').value = plan.informacionGeneral.codigoCentro || '';
                document.getElementById('nombreDocente').value = plan.informacionGeneral.nombreDocente || '';
                document.getElementById('circuito').value = plan.informacionGeneral.circuito || '';
                document.getElementById('ciclo').value = plan.informacionGeneral.ciclo || '';
                
                actualizarNiveles();
                
                document.getElementById('nivel').value = plan.informacionGeneral.nivel || '';
                document.getElementById('leccionesPlanificadas').value = plan.informacionGeneral.leccionesPlanificadas || '8';
                document.getElementById('mesInicio').value = plan.informacionGeneral.mesInicio || '';
                document.getElementById('mesFinal').value = plan.informacionGeneral.mesFinal || '';
                document.getElementById('asignatura').value = plan.informacionGeneral.asignatura || 'Formaci√≥n tecnol√≥gica/Inform√°tica Educativa';
            }
            
            if (plan.ejesTransversales) {
                document.querySelectorAll('input[name="eje"]').forEach(checkbox => {
                    checkbox.checked = plan.ejesTransversales.includes(checkbox.value);
                });
            }
            
            if (plan.metodologiaActiva) {
                document.getElementById('metodologiaActiva').value = plan.metodologiaActiva;
                mostrarDetalleMetodologia(plan.metodologiaActiva);
            }
            
            if (plan.semanas && plan.semanas.length > 0) {
                semanas = plan.semanas;
                reconstruirVistaSemanasPreservandoContenido();
            }
            
            if (plan.saberesGlobales) {
                saberesSeleccionados = new Set(plan.saberesGlobales);
            }
            
            if (plan.saberesProcedimentalesGlobales) {
                saberesProcedimentalesGlobales = new Set(plan.saberesProcedimentalesGlobales);
            }
            
            if (plan.saberesActitudinalesGlobales) {
                saberesActitudinalesGlobales = new Set(plan.saberesActitudinalesGlobales);
            }
            
            if (plan.reflexiones) {
                document.getElementById('queFunciono').value = plan.reflexiones.queFunciono || '';
                document.getElementById('queNoFunciono').value = plan.reflexiones.queNoFunciono || '';
                document.getElementById('queMejorar').value = plan.reflexiones.queMejorar || '';
            }
            
            if (plan.observaciones) {
                document.getElementById('observaciones').value = plan.observaciones || '';
            }
            
            actualizarContadoresSemanas();
            
            // FORZAR ACTUALIZACI√ìN DE SABERES CONCEPTUALES
            setTimeout(() => {
                semanas.forEach((semana, index) => {
                    actualizarRdASemana(index + 1);
                    actualizarOpcionesSaberesSemana(index + 1);
                    actualizarIndicadoresSemana(index + 1);
                    actualizarSaberesConceptualesContenedor(index + 1);
                });
            }, 500);
            
            alert('Plan cargado exitosamente');
        }

        // ===== FUNCIONES DE EXPORTACI√ìN CORREGIDAS =====

        // Funci√≥n para mostrar el modal CON INICIALIZACI√ìN
        function mostrarOpcionesExportar() {
            // 1. Inicializar formato a Word por defecto
            formatoExportacion = 'word';
            
            // 2. Limpiar selecciones visuales
            document.querySelectorAll('.export-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // 3. Seleccionar Word visualmente
            const opcionWord = document.getElementById('opcionWord');
            if (opcionWord) {
                opcionWord.classList.add('selected');
            }
            
            // 4. Mostrar modal
            document.getElementById('exportarModal').style.display = 'block';
        }

        // Funci√≥n para cerrar el modal
        function cerrarExportModal() {
            document.getElementById('exportarModal').style.display = 'none';
        }

        // ‚úÖ FUNCI√ìN CORREGIDA - Con par√°metro 'elemento'
        function seleccionarFormato(formato, elemento) {
            console.log(`Seleccionando formato: ${formato}`);
            formatoExportacion = formato;
            
            // Remover selecci√≥n de todas las opciones
            document.querySelectorAll('.export-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Agregar selecci√≥n a la opci√≥n clickeada
            if (elemento) {
                elemento.classList.add('selected');
            }
        }

        // ‚úÖ FUNCI√ìN CORREGIDA - Con validaci√≥n
        function confirmarExportacion() {
            console.log(`Exportando en formato: ${formatoExportacion}`);
            
            if (!formatoExportacion) {
                alert('Por favor, seleccione un formato de exportaci√≥n (Word o PDF)');
                return;
            }
            
            if (formatoExportacion === 'word') {
                exportarAWord();
            } else if (formatoExportacion === 'pdf') {
                exportarAPDF();
            } else {
                alert(`Formato desconocido: ${formatoExportacion}`);
                return;
            }
            
            cerrarExportModal();
        }

        function exportarAWord() {
            const nombreArchivo = document.getElementById('nombreArchivo').value || 'Planeamiento-Did√°ctico';
            const exportarInformacionGeneral = document.getElementById('exportarInformacionGeneral').checked;
            const exportarSaberes = document.getElementById('exportarSaberes').checked;
            const exportarSemanas = document.getElementById('exportarSemanas').checked;
            const exportarReflexiones = document.getElementById('exportarReflexiones').checked;
            const exportarSaberesGlobales = document.getElementById('exportarSaberesGlobales').checked;
            
            // Obtener √°reas √∫nicas de todas las semanas para RdA globales
            const areasUnicas = new Set();
            semanas.forEach(semana => {
                semana.areas.forEach(area => areasUnicas.add(area));
            });

            // Crear contenido HTML para Word
            let contenidoHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${nombreArchivo}</title>
                    <style>
                        @page {
                            size: A4 landscape;
                            margin: 0.5in;
                        }
                        body { 
                            font-family: 'Poppins', sans-serif; 
                            margin: 0; 
                            padding: 0; 
                            line-height: 1.4;
                            color: #000;
                            font-size: 12px;
                        }
                        .container {
                            width: 100%;
                            max-width: 10in;
                            margin: 0 auto;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 10px;
                            border: 1px solid #000;
                        }
                        td, th {
                            border: 1px solid #000;
                            padding: 6px;
                            vertical-align: top;
                            font-size: 11px;
                        }
                        th {
                            background: #45258F;
                            color: white;
                            font-weight: bold;
                            text-align: center;
                        }
                        .section-title {
                            background: #45258F;
                            color: white;
                            font-weight: bold;
                            text-align: center;
                            padding: 8px;
                            margin: 10px 0 5px 0;
                            border: 1px solid #000;
                            font-size: 12px;
                            width: 100%;
                            box-sizing: border-box;
                        }
                        .header {
                            text-align: center;
                            font-weight: bold;
                            font-size: 14px;
                            margin-bottom: 15px;
                            padding: 10px;
                            background: #f0f0f0;
                            border: 1px solid #000;
                        }
                        .semana-container {
                            margin-bottom: 10px;
                            page-break-inside: avoid;
                        }

                        .footer {
                            text-align: center;
                            margin-top: 20px;
                            font-weight: bold;
                            color: #45258F;
                            padding: 15px;
                            border-top: 2px solid #45258F;
                        }
                        .note {
                            margin: 15px 0;
                            padding: 10px;
                            background: #e7f3ff;
                            border-left: 3px solid #007bff;
                            border-radius: 4px;
                            font-size: 11px;
                        }
                        .checkbox-table {
                            width: 100%;
                            border: none;
                        }
                        .checkbox-table td {
                            border: none;
                            text-align: center;
                            vertical-align: middle;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
            `;
            
            // ENCABEZADO
            contenidoHTML += `
                <div class="header">
                    <strong>Plantilla de Planeamiento Did√°ctico</strong><br>
                    <strong>Programa Nacional de Formaci√≥n Tecnol√≥gica</strong>
                </div>
            `;
            
            // INFORMACI√ìN GENERAL
            if (exportarInformacionGeneral) {
                contenidoHTML += `
                    <table>
                        <tr>
                            <td width="25%"><strong>Direcci√≥n Regional de Educaci√≥n:</strong><br>${document.getElementById('direccionRegional').value || ''}</td>
                            <td width="25%"><strong>Centro educativo:</strong><br>${document.getElementById('centroEducativo').value || ''}</td>
                            <td width="25%"><strong>C√≥digo:</strong><br>${document.getElementById('codigoCentro').value || ''}</td>
                            <td width="25%"><strong>Circuito:</strong><br>${document.getElementById('circuito').value || ''}</td>
                        </tr>
                        <tr>
                            <td><strong>Nombre de la persona docente:</strong><br>${document.getElementById('nombreDocente').value || ''}</td>
                            <td colspan="2"><strong>Asignatura: Formaci√≥n tecnol√≥gica/Inform√°tica educativa</strong></td>
                            <td><strong>Curso lectivo:</strong><br>${document.getElementById('cursoLectivo').value || ''}</td>
                        </tr>
                        <tr>
                            <td><strong>Ciclo:</strong><br>${document.getElementById('ciclo').value || ''}</td>
                            <td><strong>Nivel:</strong><br>${document.getElementById('nivel').value || ''}</td>
                            <td><strong>Lecciones planificadas:</strong><br>${document.getElementById('leccionesPlanificadas').value || ''}</td>
                            <td><strong>Mes inicio - Mes final:</strong><br>${document.getElementById('mesInicio').value || ''} - ${document.getElementById('mesFinal').value || ''}</td>
                        </tr>
                    </table>
                `;
            }
            
            // EJES TRANSVERSALES
            if (exportarInformacionGeneral) {
                const ejesSeleccionados = Array.from(document.querySelectorAll('input[name="eje"]:checked')).map(cb => cb.value);
                
                contenidoHTML += `
                    <div class="section-title">Eje transversal del PNFT seg√∫n competencia MEP, marque con una equis (x) el eje a desarrollar.</div>
                    <table class="checkbox-table">
                        <tr>
                            <td width="33%" style="text-align: center; padding: 10px;">
                                <strong>Ciudadan√≠a y √©tica digital</strong><br>
                                Competencias para la ciudadan√≠a responsable y solidaria<br><br>
                                <strong>${ejesSeleccionados.includes('ciudadania') ? '[X]' : '[ ]'}</strong>
                            </td>
                            <td width="34%" style="text-align: center; padding: 10px;">
                                <strong>Pensamiento computacional para la resoluci√≥n de problemas</strong><br>
                                Competencias para la vida<br><br>
                                <strong>${ejesSeleccionados.includes('pensamiento') ? '[X]' : '[ ]'}</strong>
                            </td>
                            <td width="33%" style="text-align: center; padding: 10px;">
                                <strong>Emprendimiento e Innovaci√≥n</strong><br>
                                Competencias para el empleo digno<br><br>
                                <strong>${ejesSeleccionados.includes('emprendimiento') ? '[X]' : '[ ]'}</strong>
                            </td>
                        </tr>
                    </table>
                `;
            }
            
            // METODOLOG√çA ACTIVA
            if (exportarInformacionGeneral) {
                const metodologia = document.getElementById('metodologiaActiva').value;
                if (metodologia) {
                    let metodologiaTexto = '';
                    if (metodologia === 'ABJ') metodologiaTexto = 'Aprendizaje basado en juegos (ABJ) - 7 fases';
                    if (metodologia === 'ABR') metodologiaTexto = 'Aprendizaje basado en retos (ABR) - 3 fases';
                    if (metodologia === 'APD') metodologiaTexto = 'Aprendizaje Pensamiento por Dise√±o (APD) - 5 fases';
                    
                    contenidoHTML += `
                        <div class="section-title">Metodolog√≠a activa:</div>
                        <table>
                            <tr>
                                <td>${metodologiaTexto}</td>
                            </tr>
                        </table>
                    `;
                }
            }
            
            // ‚úÖ √ÅREAS Y RDA GLOBALES - CORREGIDO: Solo muestra las √°reas seleccionadas globalmente
            if (exportarSaberes && areasUnicas.size > 0) {
                const ciclo = document.getElementById('ciclo').value;
                
                contenidoHTML += `
                    <div class="section-title">√Årea de conocimiento y RdA:</div>
                    <table>
                        <tr>
                            <th width="40%">√Årea de conocimiento</th>
                            <th width="60%">RdA:</th>
                        </tr>
                `;
                
                areasUnicas.forEach(area => {
                    const rda = RDA_POR_CICLO[ciclo] && RDA_POR_CICLO[ciclo][area] ? RDA_POR_CICLO[ciclo][area] : 'No definido';
                    contenidoHTML += `
                        <tr>
                            <td>${area}</td>
                            <td>${rda}</td>
                        </tr>
                    `;
                });
                
                contenidoHTML += `</table>`;
            }
            
            // ‚úÖ SABERES GLOBALES ELEGIDOS POR EL DOCENTE - CORREGIDO: Solo muestra los saberes realmente seleccionados
            if (exportarSaberesGlobales) {
                contenidoHTML += `
                    <div class="section-title">Saberes Globales</div>
                    <table>
                        <tr>
                            <th width="33%">Saberes conceptuales (saber)</th>
                            <th width="33%">Saberes procedimentales (saber hacer)</th>
                            <th width="34%">Saberes actitudinales (saber ser)</th>
                        </tr>
                        <tr>
                            <td style="vertical-align: top;">
                `;
                
                // ‚úÖ SABERES CONCEPTUALES GLOBALES - Solo los seleccionados por el docente
                if (saberesSeleccionados.size > 0) {
                    contenidoHTML += Array.from(saberesSeleccionados).map(saber => `‚Ä¢ ${saber}`).join('<br>');
                } else {
                    contenidoHTML += 'No se han seleccionado saberes conceptuales';
                }
                
                contenidoHTML += `
                            </td>
                            <td style="vertical-align: top;">
                `;
                
                // ‚úÖ SABERES PROCEDIMENTALES GLOBALES - Solo los seleccionados por el docente
                if (saberesProcedimentalesGlobales.size > 0) {
                    contenidoHTML += Array.from(saberesProcedimentalesGlobales).map(proc => {
                        const mapping = {
                            'reconoce': '‚Ä¢ Reconoce patrones',
                            'abstrae': '‚Ä¢ Abstrae',
                            'generaliza': '‚Ä¢ Generaliza',
                            'transfiere': '‚Ä¢ Transfiere',
                            'modulariza': '‚Ä¢ Modulariza',
                            'formula': '‚Ä¢ Formula algoritmos',
                            'remezcla': '‚Ä¢ Remezcla',
                            'depura': '‚Ä¢ Depura',
                            'programa': '‚Ä¢ Programa',
                            'comunica': '‚Ä¢ Comunica',
                            'colabora': '‚Ä¢ Colabora',
                            'piensa': '‚Ä¢ Piensa de forma creativa',
                            'maneja': '‚Ä¢ Maneja las tecnolog√≠as de forma √©tica y segura'
                        };
                        return mapping[proc] || `‚Ä¢ ${proc}`;
                    }).join('<br>');
                } else {
                    contenidoHTML += 'No se han seleccionado saberes procedimentales';
                }
                
                contenidoHTML += `
                            </td>
                            <td style="vertical-align: top;">
                `;
                
                // ‚úÖ SABERES ACTITUDINALES GLOBALES - Solo los seleccionados por el docente
                if (saberesActitudinalesGlobales.size > 0) {
                    contenidoHTML += Array.from(saberesActitudinalesGlobales).map(act => {
                        const mapping = {
                            'gusto': '‚Ä¢ Gusto por la precisi√≥n',
                            'aprender': '‚Ä¢ Aprender del error',
                            'flexibilidad': '‚Ä¢ Flexibilidad para manejar problemas',
                            'tolerancia': '‚Ä¢ Tolerancia a la frustraci√≥n'
                        };
                        return mapping[act] || `‚Ä¢ ${act}`;
                    }).join('<br>');
                } else {
                    contenidoHTML += 'No se han seleccionado saberes actitudinales';
                }
                
                contenidoHTML += `
                            </td>
                        </tr>
                    </table>
                `;
            }
            
            // ‚úÖ PLANIFICACI√ìN POR SEMANAS - CORREGIDO: Solo las 3 columnas requeridas
            if (exportarSemanas && semanas.length > 0) {
                contenidoHTML += `<div class="section-title">Planificaci√≥n por Semanas</div>`;
                
                semanas.forEach((semana, index) => {
                    contenidoHTML += `
                        <div class="semana-container">
                            <table>
                                <tr>
                                    <td colspan="3" style="background: #45258F; color: white; font-weight: bold; text-align: center;">
                                        <strong>Semana ${index + 1}: ${semana.lecciones}</strong>
                                    </td>
                                </tr>
                                <tr>
                                    <th width="33%">Indicadores de logro</th>
                                    <th width="34%">Estrategias de Mediaci√≥n</th>
                                    <th width="33%">Indicadores de evaluaci√≥n</th>
                                </tr>
                                <tr>
                                    <td style="vertical-align: top;">${semana.indicadores || 'No especificado'}</td>
                                    <td style="vertical-align: top;">${semana.actividades || 'No especificado'}</td>
                                    <td style="vertical-align: top;">${semana.evaluacion || 'No especificado'}</td>
                                </tr>
                            </table>
                        </div>
                    `;
                });
            }
            
            // REFLEXIONES DOCENTES
            if (exportarReflexiones) {
                contenidoHTML += `
                    <div class="section-title">Reflexiones Docentes</div>
                    <table>
                        <tr>
                            <th width="33%">¬øQu√© funcion√≥?</th>
                            <th width="34%">¬øQu√© no funcion√≥?</th>
                            <th width="33%">¬øQu√© puedo mejorar?</th>
                        </tr>
                        <tr>
                            <td>${document.getElementById('queFunciono').value || ''}</td>
                            <td>${document.getElementById('queNoFunciono').value || ''}</td>
                            <td>${document.getElementById('queMejorar').value || ''}</td>
                        </tr>
                    </table>
                    
                    <div class="section-title">Observaciones y/o recomendaciones did√°cticas por nivel:</div>
                    <table>
                        <tr>
                            <td>${document.getElementById('observaciones').value || ''}</td>
                        </tr>
                    </table>
                `;
            }
            
            // NOTA SOBRE IA
            contenidoHTML += `
                <div class="note">
                    <strong>Nota importante sobre el uso de IA:</strong> Lo que brinda la IA debe ser contextualizado por el educador, 
                    quien decide, observa y ejecuta seg√∫n su criterio y conocimiento del grupo. La IA proporciona estrategias de mediaci√≥n 
                    que deben ser definidas, reagrupadas y reestructuradas por el educador considerando el orden, estructura y forma de 
                    implementaci√≥n m√°s adecuada.
                </div>
            `;
            
            // FOOTER
            contenidoHTML += `
                <div class="footer">
                    DIDI - Departamento de Investigaci√≥n, Desarrollo e Implementaci√≥n <br>
                    Direcci√≥n de Recursos Tecnol√≥gicos en Educaci√≥n
                </div>
            `;

            contenidoHTML += `
                    </div>
                </body>
                </html>
            `;
            
            // Crear y descargar el archivo Word
            const blob = new Blob([contenidoHTML], {type: 'application/msword'});
            const enlace = document.createElement('a');
            enlace.download = `${nombreArchivo}.doc`;
            enlace.href = URL.createObjectURL(blob);
            enlace.click();
            
            setTimeout(() => URL.revokeObjectURL(enlace.href), 100);
        }

        function exportarAPDF() {
    try {
        console.log("Iniciando exportaci√≥n a PDF...");
        
        // OBTENER VALORES DE CHECKBOXES
        const nombreArchivo = document.getElementById('nombreArchivo').value || 'Planeamiento-Did√°ctico';
        const exportarInformacionGeneral = document.getElementById('exportarInformacionGeneral')?.checked ?? true;
        const exportarSaberes = document.getElementById('exportarSaberes')?.checked ?? true;
        const exportarSemanas = document.getElementById('exportarSemanas')?.checked ?? true;
        const exportarReflexiones = document.getElementById('exportarReflexiones')?.checked ?? true;
        const exportarSaberesGlobales = document.getElementById('exportarSaberesGlobales')?.checked ?? true;
        const incluirEncabezado = document.getElementById('incluirEncabezado')?.checked ?? true;
        const incluirPiePagina = document.getElementById('incluirPiePagina')?.checked ?? true;
        
        // √ÅREAS √öNICAS
        const areasUnicas = new Set();
        semanas.forEach(semana => {
            semana.areas.forEach(area => areasUnicas.add(area));
        });
        
        // ===== FUNCIONES AUXILIARES MEJORADAS =====
        function limpiarContenidoParaPDF(texto) {
            if (!texto || texto.toString().trim() === '') {
                return 'No especificado';
            }
            
            let contenido = texto.toString();
            
            // 1. Convertir HTML a texto plano controlado
            contenido = contenido.replace(/<[^>]*>/g, ' ');
            
            // 2. Convertir entidades HTML
            contenido = contenido.replace(/&nbsp;/g, ' ');
            contenido = contenido.replace(/&lt;/g, '<');
            contenido = contenido.replace(/&gt;/g, '>');
            contenido = contenido.replace(/&amp;/g, '&');
            contenido = contenido.replace(/&quot;/g, '"');
            contenido = contenido.replace(/&#39;/g, "'");
            
            // 3. Normalizar espacios
            contenido = contenido.replace(/\s+/g, ' ');
            contenido = contenido.trim();
            
            return contenido;
        }
        
        function formatearContenidoComoHTML(texto) {
            const contenidoLimpio = limpiarContenidoParaPDF(texto);
            
            // Si est√° vac√≠o
            if (contenidoLimpio === 'No especificado' || contenidoLimpio.trim() === '') {
                return '<div style="color: #999; font-style: italic; font-size: 8.5pt;">No especificado</div>';
            }
            
            // Dividir por puntos para mejor legibilidad
            const lineas = contenidoLimpio.split(/(?<=\.)\s+/).filter(linea => linea.trim());
            
            if (lineas.length === 0) {
                return '<div style="color: #999; font-style: italic; font-size: 8.5pt;">No especificado</div>';
            }
            
            // Crear p√°rrafos m√°s compactos para PDF
            let resultado = '';
            
            lineas.forEach(linea => {
                // Si es una lista con n√∫meros o vi√±etas
                if (linea.match(/^\d+[-).]/) || linea.match(/^[‚Ä¢\-]/)) {
                    resultado += `<div style="margin-bottom: 1.5mm; padding-left: 1mm; line-height: 1.3; font-size: 8.5pt;">${linea.trim()}</div>`;
                } else {
                    resultado += `<div style="margin-bottom: 1.5mm; line-height: 1.3; font-size: 8.5pt; text-indent: 2mm;">${linea.trim()}</div>`;
                }
            });
            
            return resultado;
        }
        
        // ‚úÖ FUNCI√ìN NUEVA: AJUSTAR FUENTE SEG√öN LONGITUD
        function ajustarFuenteSegunLongitud(texto) {
            if (!texto || texto.toString().trim() === '') return '9.5pt';
            
            const contenidoLimpio = limpiarContenidoParaPDF(texto);
            const longitud = contenidoLimpio.length;
            
            // Escala progresiva seg√∫n longitud
            if (longitud > 3000) return '7.5pt';      // Contenido muy largo
            if (longitud > 2000) return '8pt';        // Contenido largo
            if (longitud > 1000) return '8.5pt';      // Contenido medio-largo
            if (longitud > 500) return '9pt';         // Contenido medio
            return '9.5pt';                           // Contenido corto
        }
        
        // ‚úÖ FUNCI√ìN NUEVA: AJUSTAR ALTURA M√çNIMA SEG√öN CONTENIDO
        function ajustarAlturaMinima(texto) {
            if (!texto || texto.toString().trim() === '') return '25mm';
            
            const contenidoLimpio = limpiarContenidoParaPDF(texto);
            const longitud = contenidoLimpio.length;
            
            // Ajustar altura m√≠nima seg√∫n longitud
            if (longitud > 2000) return '60mm';
            if (longitud > 1000) return '45mm';
            if (longitud > 500) return '35mm';
            return '25mm';
        }
        
        // ‚úÖ FUNCI√ìN NUEVA: FORMATEAR CONTENIDO CON AJUSTE DIN√ÅMICO
        function formatearContenidoConAjuste(texto, tipoContenido = 'general') {
            const contenidoLimpio = limpiarContenidoParaPDF(texto);
            
            // Si est√° vac√≠o
            if (contenidoLimpio === 'No especificado' || contenidoLimpio.trim() === '') {
                return {
                    html: '<div style="color: #999; font-style: italic;">No especificado</div>',
                    fontSize: '9pt',
                    minHeight: '25mm'
                };
            }
            
            // Determinar tama√±o de fuente √≥ptimo
            const fontSize = ajustarFuenteSegunLongitud(texto);
            const minHeight = ajustarAlturaMinima(texto);
            
            // Formatear contenido con el tama√±o adecuado
            const lineas = contenidoLimpio.split(/(?<=\.)\s+/).filter(linea => linea.trim());
            let html = '';
            
            lineas.forEach(linea => {
                const esLista = linea.match(/^\d+[-).]/) || linea.match(/^[‚Ä¢\-]/);
                const estiloLinea = esLista 
                    ? `margin: 0 0 1mm ${tipoContenido === 'estrategias' ? '3mm' : '1mm'}; padding-left: 1mm;`
                    : `margin: 0 0 1mm 0; text-indent: 2mm;`;
                
                html += `
                    <div style="
                        ${estiloLinea}
                        line-height: 1.35;
                        font-size: ${fontSize};
                        text-align: ${tipoContenido === 'estrategias' ? 'justify' : 'left'};
                        hyphens: auto;
                        word-wrap: break-word;
                    ">
                        ${linea.trim()}
                    </div>
                `;
            });
            
            return {
                html: html,
                fontSize: fontSize,
                minHeight: minHeight
            };
        }
        
        // ===== GENERAR HTML PERFECTO PARA PDF =====
        let contenidoHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>${nombreArchivo}</title>
    <style>
        /* ESTILOS DEFINITIVOS - PARA IMPRESI√ìN */   
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            font-size: 10pt;
            line-height: 1.3;
            color: #000000;
            margin: 0;
            padding: 15mm;
        }
        
        .pagina {
            width: 297mm;
            height: 210mm;
            padding: 10mm;
        }
        
        /* ENCABEZADOS */
        .encabezado-institucional {
            text-align: center;
            margin-bottom: 8mm;
            padding-bottom: 4mm;
            border-bottom: 1pt solid #45258F;
        }
        
        .titulo-ministerio {
            font-size: 12pt;
            font-weight: bold;
            color: #45258F;
            margin-bottom: 2mm;
        }
        
        .titulo-gobierno {
            font-size: 11pt;
            font-weight: 600;
            color: #6c47c9;
        }
        
        .titulo-principal {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            color: white;
            background-color: #45258F;
            padding: 4mm;
            margin: 6mm 0 4mm 0;
            border-radius: 2mm;
        }
        
        .subtitulo {
            text-align: center;
            font-size: 11pt;
            color: #6c47c9;
            margin-bottom: 8mm;
        }
        
        /* SECCIONES */
        .seccion {
            margin-bottom: 6mm;
            page-break-inside: avoid;
        }
        
        .titulo-seccion {
            background-color: #45258F;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 3mm;
            margin: 4mm 0 3mm 0;
            border-radius: 2mm;
            font-size: 11pt;
            page-break-after: avoid;
        }
        
        /* TABLAS PERFECTAS */
        .tabla {
            width: 100%;
            border-collapse: collapse;
            margin: 3mm 0;
            page-break-inside: avoid;
        }
        
        .tabla th {
            background-color: #45258F;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 2mm;
            border: 0.5pt solid black;
            font-size: 10pt;
        }
        
        .tabla td {
            border: 0.5pt solid #cccccc;
            padding: 2mm;
            vertical-align: top;
            font-size: 10pt;
            line-height: 1.3;
        }
        
        /* CONTENIDO */
        .contenido-celda {
            font-size: 10pt;
            line-height: 1.3;
            text-align: left;
        }
        
        .contenido-celda div {
            margin-bottom: 1mm;
        }
        
        /* SEMANAS */
        .encabezado-semana {
            background-color: #45258F;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 2mm;
            font-size: 11pt;
        }
        
        /* TRANSICI√ìN SIN ESPACIOS */
        .linea-transicion {
            border-top: 0.5pt solid #6c47c9;
            margin: 3mm 0 2mm 0;
            height: 0;
        }
        
        .texto-transicion {
            text-align: center;
            color: #6c47c9;
            font-size: 10pt;
            font-style: italic;
            margin: 1mm 0 3mm 0;
        }
        
        /* ELEMENTOS DE DISE√ëO */
        .tarjeta {
            background: white;
            border: 0.5pt solid #dddddd;
            border-radius: 2mm;
            padding: 3mm;
            margin-bottom: 3mm;
        }
        
        .tarjeta-titulo {
            font-weight: bold;
            color: #45258F;
            margin-bottom: 2mm;
            font-size: 10.5pt;
        }
        
        .tarjeta-contenido {
            font-size: 10pt;
            line-height: 1.3;
        }
        
        /* CONTROL DE IMPRESI√ìN MEJORADO */
        @media print {
            @page {
                size: A4 landscape;
                margin: 15mm;
            }
            
            body {
                margin: 0 !important;
                padding: 15mm !important;
                orphans: 3;
                widows: 3;
            }
            
            .pagina {
                page-break-after: always;
            }
            
            .no-imprimir {
                display: none !important;
            }
            
            .titulo-seccion, .encabezado-semana-mejorado, .tabla th {
                background-color: #45258F !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                page-break-after: avoid;
            }
            
            /* MEJOR CONTROL DE DIVISI√ìN DE CONTENIDO */
            .contenido-adaptable {
                page-break-inside: auto !important;
                break-inside: auto !important;
            }
            
            /* Evitar que los encabezados queden solos */
            .encabezado-contenido {
                page-break-after: avoid;
            }
            
            /* Mejor legibilidad para texto peque√±o */
            .texto-ajustado {
                -webkit-font-smoothing: antialiased;
                text-rendering: optimizeLegibility;
            }
        }
        
        /* UTILIDADES */
        .columna-33 {
            width: 33.33%;
        }
        
        .texto-centrado {
            text-align: center;
        }
        
        .texto-izquierda {
            text-align: left;
        }
        
        .margen-abajo {
            margin-bottom: 3mm;
        }
        
        /* GRID SIMPLE */
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3mm;
            margin: 3mm 0;
        }
        
        /* NUEVOS ESTILOS PARA DISE√ëO MEJORADO */
        .grid-2-columnas {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6mm;
            margin: 4mm 0;
            align-items: stretch;
        }
        
        .columna-areas {
            border: 0.75pt solid #45258F;
            border-radius: 3mm;
            padding: 4mm;
            background: #f8f9fa;
        }
        
        .columna-rda {
            border: 0.75pt solid #6c47c9;
            border-radius: 3mm;
            padding: 4mm;
            background: #f0ebf9;
        }
        
        .titulo-columna {
            font-weight: bold;
            text-align: center;
            margin-bottom: 4mm;
            padding-bottom: 2mm;
            border-bottom: 1pt solid;
            font-size: 11pt;
        }
        
        .item-area {
            padding: 3mm;
            background: white;
            border-radius: 2mm;
            border-left: 3pt solid #45258F;
            font-weight: 500;
            font-size: 10pt;
            margin-bottom: 2mm;
            box-shadow: 0 1pt 3pt rgba(0,0,0,0.1);
        }
        
        .item-rda {
            padding: 3mm;
            background: white;
            border-radius: 2mm;
            border-left: 3pt solid #6c47c9;
            margin-bottom: 3mm;
            box-shadow: 0 1pt 3pt rgba(0,0,0,0.1);
        }
        
        .ejes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4mm;
            margin: 3mm 0;
        }
        
        .eje-item {
            border: 0.75pt solid #cccccc;
            border-radius: 3mm;
            padding: 4mm;
            text-align: center;
            background: white;
            transition: all 0.3s;
        }
        
        .eje-seleccionado {
            border: 1.5pt solid #45258F;
            background: #f0ebf9;
        }
        
        .eje-titulo {
            font-weight: bold;
            font-size: 11pt;
            margin-bottom: 2mm;
        }
        
        .eje-descripcion {
            font-size: 10pt;
            color: #666;
            margin-bottom: 3mm;
            line-height: 1.3;
        }
        
        .eje-marca {
            font-weight: bold;
            font-size: 12pt;
            border-radius: 2mm;
            padding: 2mm;
            display: inline-block;
            min-width: 25mm;
        }
        
        .marca-seleccionada {
            color: #28a745;
            border: 1.5pt solid #28a745;
        }
        
        .marca-no-seleccionada {
            color: #666;
            border: 1pt solid #666;
        }
        
        /* ESTILOS PARA CONTENIDO ADAPTABLE */
        .contenido-adaptable {
            page-break-inside: auto;
            break-inside: auto;
        }
        
        .encabezado-semana-mejorado {
            background: linear-gradient(135deg, #45258F, #6c47c9);
            color: white;
            font-weight: bold;
            padding: 2mm 3mm;
            font-size: 10.5pt;
            border-radius: 1.5mm 1.5mm 0 0;
            page-break-after: avoid;
            box-shadow: 0 1pt 2pt rgba(0,0,0,0.1);
        }
        
        .encabezado-contenido {
            font-weight: bold;
            color: #45258F;
            font-size: 9.5pt;
            margin-bottom: 1.5mm;
            padding-bottom: 1mm;
            border-bottom: 0.5pt solid #f0f0f0;
            page-break-after: avoid;
        }
        
        .texto-ajustado {
            text-align: justify;
            hyphens: auto;
            word-wrap: break-word;
            line-height: 1.35;
        }
    </style>
</head>
<body>
    <div class="pagina">
`;
        
        // ENCABEZADO INSTITUCIONAL
        if (incluirEncabezado) {
            contenidoHTML += `
        <div class="encabezado-institucional">
            <div class="titulo-ministerio">MINISTERIO DE EDUCACI√ìN P√öBLICA</div>
            <div class="titulo-gobierno">Gobierno de Costa Rica</div>
        </div>
`;
        }
        
        // T√çTULO PRINCIPAL
        contenidoHTML += `
        <div class="titulo-principal">PLANTILLA DE PLANEAMIENTO DID√ÅCTICO</div>
        <div class="subtitulo">
            PROGRAMA NACIONAL DE FORMACI√ìN TECNOL√ìGICA<br>
            <span style="font-size: 10pt;">Inform√°tica educativa</span>
        </div>
`;
        
        // INFORMACI√ìN GENERAL
        if (exportarInformacionGeneral) {
            contenidoHTML += `
        <div class="seccion">
            <div class="titulo-seccion">INFORMACI√ìN GENERAL</div>
            <table class="tabla">
                <tr>
                    <td style="width: 25%;"><strong>Direcci√≥n Regional:</strong><br>${document.getElementById('direccionRegional').value || ''}</td>
                    <td style="width: 25%;"><strong>Centro educativo:</strong><br>${document.getElementById('centroEducativo').value || ''}</td>
                    <td style="width: 25%;"><strong>C√≥digo:</strong><br>${document.getElementById('codigoCentro').value || ''}</td>
                    <td style="width: 25%;"><strong>Circuito:</strong><br>${document.getElementById('circuito').value || ''}</td>
                </tr>
                <tr>
                    <td><strong>Docente:</strong><br>${document.getElementById('nombreDocente').value || ''}</td>
                    <td><strong>Asignatura:</strong><br>Formaci√≥n tecnol√≥gica/Inform√°tica educativa</td>
                    <td><strong>Ciclo/Nivel:</strong><br>${document.getElementById('ciclo').value || ''} / ${document.getElementById('nivel').value || ''}</td>
                    <td><strong>Lecciones:</strong><br>${document.getElementById('leccionesPlanificadas').value || ''}</td>
                </tr>
            </table>
        </div>
`;
        }
        
        // EJES TRANSVERSALES - CORREGIDO Y COMPLETO
        if (exportarInformacionGeneral) {
            const ejesSeleccionados = Array.from(document.querySelectorAll('input[name="eje"]:checked')).map(cb => cb.value);
            
            contenidoHTML += `
        <div class="seccion">
            <div class="titulo-seccion">EJES TRANSVERSALES DEL PNFT SEG√öN COMPETENCIA MEP</div>
            
            <div style="text-align: center; font-size: 10pt; color: #666; margin-bottom: 4mm; font-style: italic;">
                Marque con una equis (x) el eje a desarrollar
            </div>
            
            <div class="ejes-grid">
                <!-- CIUDADAN√çA -->
                <div class="eje-item ${ejesSeleccionados.includes('ciudadania') ? 'eje-seleccionado' : ''}">
                    <div class="eje-titulo" style="color: ${ejesSeleccionados.includes('ciudadania') ? '#45258F' : '#333'}">
                        Ciudadan√≠a y √©tica digital
                    </div>
                    
                    <div class="eje-descripcion">
                        Competencias para la ciudadan√≠a responsable y solidaria
                    </div>
                    
                    <div class="eje-marca ${ejesSeleccionados.includes('ciudadania') ? 'marca-seleccionada' : 'marca-no-seleccionada'}">
                        ${ejesSeleccionados.includes('ciudadania') ? '[X] SELECCIONADO' : '[   ]'}
                    </div>
                </div>
                
                <!-- PENSAMIENTO COMPUTACIONAL -->
                <div class="eje-item ${ejesSeleccionados.includes('pensamiento') ? 'eje-seleccionado' : ''}">
                    <div class="eje-titulo" style="color: ${ejesSeleccionados.includes('pensamiento') ? '#45258F' : '#333'}">
                        Pensamiento computacional
                    </div>
                    
                    <div class="eje-descripcion">
                        Competencias para la vida y resoluci√≥n de problemas
                    </div>
                    
                    <div class="eje-marca ${ejesSeleccionados.includes('pensamiento') ? 'marca-seleccionada' : 'marca-no-seleccionada'}">
                        ${ejesSeleccionados.includes('pensamiento') ? '[X] SELECCIONADO' : '[   ]'}
                    </div>
                </div>
                
                <!-- EMPRENDIMIENTO -->
                <div class="eje-item ${ejesSeleccionados.includes('emprendimiento') ? 'eje-seleccionado' : ''}">
                    <div class="eje-titulo" style="color: ${ejesSeleccionados.includes('emprendimiento') ? '#45258F' : '#333'}">
                        Emprendimiento e Innovaci√≥n
                    </div>
                    
                    <div class="eje-descripcion">
                        Competencias para el empleo digno
                    </div>
                    
                    <div class="eje-marca ${ejesSeleccionados.includes('emprendimiento') ? 'marca-seleccionada' : 'marca-no-seleccionada'}">
                        ${ejesSeleccionados.includes('emprendimiento') ? '[X] SELECCIONADO' : '[   ]'}
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; font-size: 9pt; color: #999; margin-top: 3mm; font-style: italic;">
                Nota: Se marca con X el eje transversal seleccionado para desarrollar seg√∫n competencia MEP
            </div>
        </div>
    `;
        }
        
        // √ÅREAS DE CONOCIMIENTO Y RDA EN DOS COLUMNAS - VERSI√ìN MEJORADA
        if (exportarSaberes && areasUnicas.size > 0) {
            const ciclo = document.getElementById('ciclo').value;
            
            contenidoHTML += `
        <div class="seccion">
            <div class="titulo-seccion">√ÅREAS DE CONOCIMIENTO Y RESULTADOS DE APRENDIZAJE (RDA)</div>
            
            <!-- CONTENEDOR DE DOS COLUMNAS PARALELAS -->
            <div class="grid-2-columnas">
                
                <!-- COLUMNA IZQUIERDA: √ÅREAS DE CONOCIMIENTO -->
                <div class="columna-areas">
                    <div class="titulo-columna" style="color: #45258F; border-bottom-color: #45258F;">
                        √ÅREAS DE CONOCIMIENTO
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 2mm;">
            `;
            
            // Lista completa de √°reas (para mostrar todas con su estado)
            const todasLasAreas = [
                "Apropiaci√≥n tecnol√≥gica y Digital",
                "Programaci√≥n y Algoritmos", 
                "Computaci√≥n f√≠sica y Rob√≥tica",
                "Ciencia de datos e Inteligencia artificial"
            ];
            
            todasLasAreas.forEach(area => {
                const estaSeleccionada = areasUnicas.has(area);
                
                contenidoHTML += `
                        <div class="item-area" style="border-left-color: ${estaSeleccionada ? '#45258F' : '#cccccc'}; background: ${estaSeleccionada ? '#f0ebf9' : 'white'}">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: ${estaSeleccionada ? 'bold' : 'normal'}; color: ${estaSeleccionada ? '#45258F' : '#333'}">
                                    ${area}
                                </span>
                                <span style="font-weight: bold; font-size: 11pt; color: ${estaSeleccionada ? '#28a745' : '#ccc'}">
                                    ${estaSeleccionada ? '[‚úì]' : '[  ]'}
                                </span>
                            </div>
                        </div>
                `;
            });
            
            contenidoHTML += `
                    </div>
                </div>
                
                <!-- COLUMNA DERECHA: RESULTADOS DE APRENDIZAJE (RDA) -->
                <div class="columna-rda">
                    <div class="titulo-columna" style="color: #6c47c9; border-bottom-color: #6c47c9;">
                        RESULTADOS DE APRENDIZAJE (RDA)
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 3mm;">
            `;
            
            // Mostrar RdA solo para √°reas seleccionadas
            if (areasUnicas.size > 0) {
                areasUnicas.forEach(area => {
                    const rda = RDA_POR_CICLO[ciclo] && RDA_POR_CICLO[ciclo][area] 
                        ? RDA_POR_CICLO[ciclo][area] 
                        : 'No definido para este ciclo/nivel';
                    
                    contenidoHTML += `
                        <div class="item-rda">
                            <div style="font-weight: 600; color: #333; margin-bottom: 1.5mm; font-size: 10pt;">
                                ${area}:
                            </div>
                            <div style="font-size: 9.5pt; line-height: 1.4; color: #555;">
                                ${rda}
                            </div>
                        </div>
                    `;
                });
            } else {
                contenidoHTML += `
                    <div style="padding: 4mm; text-align: center; color: #999; font-style: italic; font-size: 10pt;">
                        Seleccione √°reas de conocimiento para ver los Resultados de Aprendizaje
                    </div>
                `;
            }
            
            contenidoHTML += `
                    </div>
                </div>
            </div> <!-- Fin del grid de 2 columnas -->
            
            <div style="text-align: center; font-size: 9pt; color: #666; margin-top: 3mm; font-style: italic;">
                Nota: Cada √Årea de Conocimiento tiene su correspondiente Resultado de Aprendizaje (RdA) seg√∫n el ciclo seleccionado
            </div>
        </div>
    `;
        }
        
        // SABERES GLOBALES - CORREGIDO
        if (exportarSaberesGlobales) {
            contenidoHTML += `
        <div class="seccion">
            <div class="titulo-seccion">SABERES GLOBALES</div>
            
            <div class="grid-3">
                <!-- CONCEPTUALES -->
                <div class="tarjeta">
                    <div class="tarjeta-titulo">Saberes Conceptuales (Saber)</div>
                    <div class="tarjeta-contenido">
            `;
            
            if (saberesSeleccionados.size > 0) {
                contenidoHTML += Array.from(saberesSeleccionados).map(saber => 
                    `<div style="margin-bottom: 1mm; padding-left: 2mm; border-left: 2pt solid #45258F;">‚Ä¢ ${saber}</div>`
                ).join('');
            } else {
                contenidoHTML += '<div style="color: #999; font-style: italic;">No se han seleccionado saberes conceptuales</div>';
            }
            
            contenidoHTML += `
                    </div>
                </div>
                
                <!-- PROCEDIMENTALES -->
                <div class="tarjeta">
                    <div class="tarjeta-titulo">Saberes Procedimentales (Saber Hacer)</div>
                    <div class="tarjeta-contenido">
            `;
            
            if (saberesProcedimentalesGlobales.size > 0) {
                const procMap = {
                    'reconoce': 'Reconoce patrones',
                    'abstrae': 'Abstrae',
                    'generaliza': 'Generaliza',
                    'transfiere': 'Transfiere',
                    'modulariza': 'Modulariza',
                    'formula': 'Formula algoritmos',
                    'remezcla': 'Remezcla',
                    'depura': 'Depura',
                    'programa': 'Programa',
                    'comunica': 'Comunica',
                    'colabora': 'Colabora',
                    'piensa': 'Piensa creativamente',
                    'maneja': 'Maneja tecnolog√≠as √©ticamente'
                };
                
                contenidoHTML += Array.from(saberesProcedimentalesGlobales).map(proc => 
                    `<div style="margin-bottom: 1mm; padding-left: 2mm; border-left: 2pt solid #6c47c9;">‚Ä¢ ${procMap[proc] || proc}</div>`
                ).join('');
            } else {
                contenidoHTML += '<div style="color: #999; font-style: italic;">No se han seleccionado saberes procedimentales</div>';
            }
            
            contenidoHTML += `
                    </div>
                </div>
                
                <!-- ACTITUDINALES -->
                <div class="tarjeta">
                    <div class="tarjeta-titulo">Saberes Actitudinales (Saber Ser)</div>
                    <div class="tarjeta-contenido">
            `;
            
            if (saberesActitudinalesGlobales.size > 0) {
                const actMap = {
                    'gusto': 'Gusto por la precisi√≥n',
                    'aprender': 'Aprender del error',
                    'flexibilidad': 'Flexibilidad',
                    'tolerancia': 'Tolerancia a la frustraci√≥n'
                };
                
                contenidoHTML += Array.from(saberesActitudinalesGlobales).map(act => 
                    `<div style="margin-bottom: 1mm; padding-left: 2mm; border-left: 2pt solid #28a745;">‚Ä¢ ${actMap[act] || act}</div>`
                ).join('');
            } else {
                contenidoHTML += '<div style="color: #999; font-style: italic;">No se han seleccionado saberes actitudinales</div>';
            }
            
            contenidoHTML += `
                    </div>
                </div>
            </div> <!-- Fin del grid-3 -->
        </div>
    `;
        }
        
        // TRANSICI√ìN
        contenidoHTML += `
        <div class="linea-transicion"></div>
        <div class="texto-transicion">Continuaci√≥n: Aplicaci√≥n de saberes en la planificaci√≥n semanal</div>
`;
        
        // ‚úÖ PLANIFICACI√ìN POR SEMANAS - VERSI√ìN MEJORADA CON AJUSTE AUTOM√ÅTICO
        if (exportarSemanas && semanas.length > 0) {
            contenidoHTML += `
        <div class="seccion" style="page-break-inside: avoid;">
            <div class="titulo-seccion" style="page-break-after: avoid;">PLANIFICACI√ìN POR SEMANAS</div>
    `;
            
            semanas.forEach((semana, index) => {
                // ‚úÖ Obtener contenido formateado con ajuste autom√°tico
                const contenidoIndicadores = formatearContenidoConAjuste(semana.indicadores, 'indicadores');
                const contenidoEstrategias = formatearContenidoConAjuste(semana.actividades, 'estrategias');
                const contenidoEvaluacion = formatearContenidoConAjuste(semana.evaluacion, 'evaluacion');
                
                contenidoHTML += `
            <!-- SEMANA ${index + 1} - CON AJUSTE DIN√ÅMICO -->
            <div class="contenido-adaptable" style="margin-bottom: ${index < semanas.length - 1 ? '6mm' : '0'};">
            
                <!-- T√çTULO DE SEMANA - NO SE SEPARA DEL CONTENIDO -->
                <div class="encabezado-semana-mejorado" style="page-break-after: avoid;">
                    <span style="font-size: 11pt;">üìÖ</span> ${semana.nombre} - ${semana.lecciones}
                </div>
                
                <!-- CONTENIDO: Se divide inteligentemente si es necesario -->
                <div style="
                    display: flex;
                    border: 0.5pt solid #ddd;
                    border-top: none;
                    border-radius: 0 0 1.5mm 1.5mm;
                    overflow: hidden;
                    min-height: ${Math.max(
                        contenidoIndicadores.minHeight,
                        contenidoEstrategias.minHeight,
                        contenidoEvaluacion.minHeight
                    )};
                ">
                
                    <!-- COLUMNA 1: INDICADORES DE LOGRO -->
                    <div style="
                        flex: 1;
                        border-right: 0.5pt solid #eee;
                        padding: 2.5mm;
                        display: flex;
                        flex-direction: column;
                    ">
                        <div class="encabezado-contenido">
                            Indicadores de logro
                        </div>
                        <div style="
                            flex-grow: 1;
                            overflow: hidden;
                        " class="texto-ajustado">
                            ${contenidoIndicadores.html}
                        </div>
                        <div style="
                            font-size: 7pt;
                            color: #999;
                            text-align: right;
                            margin-top: 1mm;
                            font-style: italic;
                        ">
                            Tama√±o: ${contenidoIndicadores.fontSize}
                        </div>
                    </div>
                    
                    <!-- COLUMNA 2: ESTRATEGIAS DE MEDIACI√ìN -->
                    <div style="
                        flex: 1;
                        border-right: 0.5pt solid #eee;
                        padding: 2.5mm;
                        display: flex;
                        flex-direction: column;
                    ">
                        <div class="encabezado-contenido">
                            Estrategias de Mediaci√≥n
                        </div>
                        <div style="
                            flex-grow: 1;
                            overflow: hidden;
                        " class="texto-ajustado">
                            ${contenidoEstrategias.html}
                        </div>
                        <div style="
                            font-size: 7pt;
                            color: #999;
                            text-align: right;
                            margin-top: 1mm;
                            font-style: italic;
                        ">
                            Tama√±o: ${contenidoEstrategias.fontSize}
                        </div>
                    </div>
                    
                    <!-- COLUMNA 3: INDICADORES DE EVALUACI√ìN -->
                    <div style="
                        flex: 1;
                        padding: 2.5mm;
                        display: flex;
                        flex-direction: column;
                    ">
                        <div class="encabezado-contenido">
                            Indicadores de evaluaci√≥n
                        </div>
                        <div style="
                            flex-grow: 1;
                            overflow: hidden;
                        " class="texto-ajustado">
                            ${contenidoEvaluacion.html}
                        </div>
                        <div style="
                            font-size: 7pt;
                            color: #999;
                            text-align: right;
                            margin-top: 1mm;
                            font-style: italic;
                        ">
                            Tama√±o: ${contenidoEvaluacion.fontSize}
                        </div>
                    </div>
                    
                </div>
                
            </div>
            
            <!-- L√çNEA DIVISORIA (solo entre semanas) -->
            ${index < semanas.length - 1 ? `
                <div style="
                    height: 0.5pt;
                    background: linear-gradient(to right, transparent, #6c47c9, transparent);
                    margin: 3mm 0;
                "></div>
            ` : ''}
        `;
            });
            
            contenidoHTML += `
        </div>
    `;
        }
        
        // REFLEXIONES
        if (exportarReflexiones) {
            contenidoHTML += `
        <div class="seccion">
            <div class="titulo-seccion">REFLEXIONES DOCENTES</div>
            <div class="grid-3">
                <div class="tarjeta">
                    <div class="tarjeta-titulo" style="color: #28a745;">¬øQu√© funcion√≥?</div>
                    <div class="tarjeta-contenido">
                        ${formatearContenidoComoHTML(document.getElementById('queFunciono').value)}
                    </div>
                </div>
                
                <div class="tarjeta">
                    <div class="tarjeta-titulo" style="color: #ff6b6b;">¬øQu√© no funcion√≥?</div>
                    <div class="tarjeta-contenido">
                        ${formatearContenidoComoHTML(document.getElementById('queNoFunciono').value)}
                    </div>
                </div>
                
                <div class="tarjeta">
                    <div class="tarjeta-titulo" style="color: #ff9800;">¬øQu√© puedo mejorar?</div>
                    <div class="tarjeta-contenido">
                        ${formatearContenidoComoHTML(document.getElementById('queMejorar').value)}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="seccion">
            <div class="titulo-seccion">OBSERVACIONES Y/O RECOMENDACIONES DID√ÅCTICAS POR NIVEL</div>
            <div class="tarjeta">
                <div class="tarjeta-contenido">
                    ${formatearContenidoComoHTML(document.getElementById('observaciones').value)}
                </div>
            </div>
        </div>
`;
        }
        
        // NOTA IA
        contenidoHTML += `
        <div class="tarjeta" style="background-color: #e8f4fd; border-color: #bbdefb;">
            <div class="tarjeta-titulo" style="color: #0d47a1;">Nota importante sobre el uso de IA</div>
            <div class="tarjeta-contenido">
                Lo que brinda la IA debe ser contextualizado por el educador, quien decide, observa y ejecuta seg√∫n su criterio y conocimiento del grupo. 
                La IA proporciona estrategias de mediaci√≥n que deben ser definidas, reagrupadas y reestructuradas por el educador considerando el orden, 
                estructura y forma de implementaci√≥n m√°s adecuada.
            </div>
        </div>
`;
        
        // PIE DE P√ÅGINA
        if (incluirPiePagina) {
            contenidoHTML += `
        <div class="texto-centrado" style="margin-top: 8mm; padding-top: 4mm; border-top: 1pt solid #45258F;">
            <div style="font-weight: bold; color: #45258F; margin-bottom: 2mm; font-size: 11pt;">
                DIDI - Departamento de Investigaci√≥n, Desarrollo e Implementaci√≥n
            </div>
            <div style="color: #6c47c9; margin-bottom: 2mm; font-size: 10pt;">
                Direcci√≥n de Recursos Tecnol√≥gicos en Educaci√≥n
            </div>
            <div style="color: #888; font-size: 9pt;">
                Ministerio de Educaci√≥n P√∫blica - Gobierno de Costa Rica
            </div>
        </div>
`;
        }
        
        contenidoHTML += `
    </div>
</body>
</html>`;
        
        // ===== M√âTODO DEFINITIVO PARA GENERAR PDF =====
        try {
            // Crear ventana para vista previa
            const ventanaPreview = window.open('', '_blank');
            if (!ventanaPreview) {
                const blob = new Blob([contenidoHTML], {type: 'text/html'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${nombreArchivo}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('Se ha descargado un archivo HTML. √Åbrelo en tu navegador y usa Ctrl+P para imprimir.');
                return;
            }
            
            ventanaPreview.document.write(contenidoHTML);
            ventanaPreview.document.close();
            
            setTimeout(() => {
                ventanaPreview.focus();
                
                // Instrucciones optimizadas
                ventanaPreview.document.body.innerHTML += `
                    <div class="no-imprimir" style="
                        position: fixed; 
                        top: 10px; 
                        right: 10px; 
                        background: #45258F; 
                        color: white; 
                        padding: 10px; 
                        border-radius: 5px; 
                        z-index: 10000;
                        font-size: 10pt;
                        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                        max-width: 300px;
                    ">
                        <strong>üìã Instrucciones para imprimir:</strong><br>
                        1. Presione <strong>Ctrl+P</strong><br>
                        2. Seleccione <strong>"Guardar como PDF"</strong><br>
                        3. Ajuste m√°rgenes a <strong>15mm</strong><br>
                        4. Active <strong>"Fondo gr√°fico"</strong><br>
                        5. Guarde el archivo
                    </div>
                `;
                
                const printButton = ventanaPreview.document.createElement('button');
                printButton.innerHTML = 'üñ®Ô∏è Imprimir Ahora';
                printButton.classList.add("no-imprimir");
                printButton.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 10px;
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    z-index: 10000;
                    font-size: 11pt;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                `;
                printButton.onclick = () => ventanaPreview.print();
                ventanaPreview.document.body.appendChild(printButton);
                
            }, 1000);
            
        } catch (error) {
            console.error('Error al generar PDF:', error);
            
            const blob = new Blob([contenidoHTML], {type: 'text/html'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${nombreArchivo}_para_imprimir.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Se ha descargado un archivo HTML listo para imprimir. √Åbrelo y usa Ctrl+P.');
        }
        
        cerrarExportModal();
        
    } catch (error) {
        console.error('Error general:', error);
        alert('Error: ' + error.message + '\n\nSe ha descargado un archivo HTML de respaldo.');
        
        const blob = new Blob(['<html><body><h1>Documento de respaldo</h1></body></html>'], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${nombreArchivo}_respaldo.html`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
}

        // Funciones para Prompt IA
        function generarPromptSemana(numeroSemana) {
            const semana = semanas[numeroSemana-1];
            const ciclo = document.getElementById('ciclo').value;
            const nivel = document.getElementById('nivel').value;
            
            if (semana.areas.length === 0) {
                alert('Por favor, seleccione el ciclo, nivel y al menos un √°rea de conocimiento para esta semana.');
                return;
            }
            
            let prompt = `Como especialista en educaci√≥n, necesito que generes estrategias de mediaci√≥n para la SEMANA ${numeroSemana} (${semana.lecciones}) del nivel ${nivel} del ${ciclo}.\n\n`;
            
            prompt += `CONTEXTO DE LA SEMANA:\n`;
            prompt += `- √Åreas: ${semana.areas.join(', ')}\n`;
            prompt += `- Saberes conceptuales: ${semana.saberes.join(', ')}\n`;
            prompt += `- Saberes procedimentales: ${semana.procedimentales.map(proc => {
                const mapping = {
                    'reconoce': 'Reconoce patrones',
                    'abstrae': 'Abstrae',
                    'generaliza': 'Generaliza',
                    'transfiere': 'Transfiere',
                    'modulariza': 'Modulariza',
                    'formula': 'Formula algoritmos',
                    'remezcla': 'Remezcla',
                    'depura': 'Depura',
                    'programa': 'Programa',
                    'comunica': 'Comunica',
                    'colabora': 'Colabora',
                    'piensa': 'Piensa de forma creativa',
                    'maneja': 'Maneja las tecnolog√≠as de forma √©tica y segura'
                };
                return mapping[proc] || proc;
            }).join(', ')}\n`;
            prompt += `- Saberes actitudinales: ${semana.actitudinales.map(act => {
                const mapping = {
                    'gusto': 'Gusto por la precisi√≥n',
                    'aprender': 'Aprender del error',
                    'flexibilidad': 'Flexibilidad para manejar problemas',
                    'tolerancia': 'Tolerancia a la frustraci√≥n'
                };
                return mapping[act] || act;
            }).join(', ')}\n\n`;
            
            prompt += `INDICADORES DE LOGRO:\n`;
            semana.saberes.forEach(saber => {
                const saberData = Object.values(PNFT_DATA[document.getElementById('nivel').value] || {})
                    .find(area => area.saberes.find(s => s.nombre === saber));
                if (saberData) {
                    const saberInfo = saberData.saberes.find(s => s.nombre === saber);
                    if (saberInfo) {
                        saberInfo.indicadores.forEach(indicador => {
                            prompt += `‚Ä¢ ${indicador}\n`;
                        });
                    }
                }
            });
            prompt += `\n`;
            
            prompt += `RESULTADOS DE APRENDIZAJE PARA ESTA SEMANA:\n`;
            semana.areas.forEach(area => {
                if (RDA_POR_CICLO[ciclo] && RDA_POR_CICLO[ciclo][area]) {
                    prompt += `- ${area}: ${RDA_POR_CICLO[ciclo][area]}\n`;
                }
            });
            prompt += `\n`;
            
            prompt += `SOLICITO PARA ESTA SEMANA ESPEC√çFICA:\n`;
            prompt += `Genera actividades de mediaci√≥n creativas que:\n`;
            prompt += `1. Se enfoquen en la articulaci√≥n de los saberes conceptuales espec√≠ficos de esta semana.\n`;
            prompt += `2. Desarrollen los saberes procedimentales y actitudinales seleccionados.\n`;
            prompt += `3. Sean adecuadas para ${semana.lecciones}.\n`;
            prompt += `4. Incluyan recursos tecnol√≥gicos apropiados.\n`;
            prompt += `5. Contengan instrumentos de evaluaci√≥n formativa.\n`;
            prompt += `6. Sean pr√°cticas y contextualizadas.\n`;
            prompt += `7. Redactar un indicador de evaluaci√≥n por cada indicador de logro que se haya seleccionado.\n\n`;
            
            prompt += `Por favor, proporciona actividades secuenciadas que permitan alcanzar los indicadores de logro especificados.`;
            
            document.getElementById('promptText').value = prompt;
            document.getElementById('promptModal').style.display = 'block';
        }

        function generarPromptCompleto() {
            const ciclo = document.getElementById('ciclo').value;
            const nivel = document.getElementById('nivel').value;
            
            if (!ciclo || !nivel) {
                alert('Por favor, seleccione ciclo y nivel');
                return;
            }
            
            let prompt = `Como especialista en educaci√≥n, necesito un resumen general de estrategias de mediaci√≥n para todo el planeamiento del nivel ${nivel} del ${ciclo}.\n\n`;
            
            prompt += `CONTEXTO GENERAL:\n`;
            prompt += `- Curso lectivo: ${document.getElementById('cursoLectivo').value}\n`;
            prompt += `- Semestre: ${document.getElementById('semestre').value}\n`;
            prompt += `- Total de lecciones: ${document.getElementById('leccionesPlanificadas').value}\n`;
            prompt += `- Meses: ${document.getElementById('mesInicio').value} a ${document.getElementById('mesFinal').value}\n`;
            prompt += `- Total de semanas: ${semanas.length}\n\n`;
            
            prompt += `RESUMEN POR SEMANAS:\n`;
            semanas.forEach((semana, index) => {
                prompt += `SEMANA ${index + 1} (${semana.lecciones}):\n`;
                prompt += `- √Åreas: ${semana.areas.join(', ')}\n`;
                prompt += `- Saberes conceptuales: ${semana.saberes.join(', ')}\n`;
                prompt += `- Saberes procedimentales: ${semana.procedimentales.length}\n`;
                prompt += `- Saberes actitudinales: ${semana.actitudinales.length}\n\n`;
            });
            
            prompt += `SABERES CONCEPTUALES GLOBALES (Todas las semanas):\n`;
            saberesSeleccionados.forEach(saber => {
                prompt += `- ${saber}\n`;
            });
            prompt += `\n`;
            
            prompt += `SOLICITO UN RESUMEN GENERAL QUE:\n`;
            prompt += `1. Identifique patrones comunes en todas las semanas.\n`;
            prompt += `2. Sugiera estrategias transversales aplicables.\n`;
            prompt += `3. Recomiende secuenciaci√≥n y articulaci√≥n global de saberes conceptuales.\n`;
            prompt += `4. Proponga evaluaci√≥n integral del proceso.\n`;
            prompt += `5. Ofrezca recomendaciones para mejorar la coherencia entre semanas.\n`;
            prompt += `6. Redactar un indicador de evaluaci√≥n por cada indicador de logro que se haya seleccionado.\n\n`;
            
            prompt += `El enfoque debe ser en la visi√≥n global del planeamiento y c√≥mo las diferentes semanas se complementan entre s√≠.`;
            
            document.getElementById('promptText').value = prompt;
            document.getElementById('promptModal').style.display = 'block';
        }

        function cerrarPromptModal() {
            document.getElementById('promptModal').style.display = 'none';
        }

        function copiarPrompt() {
            const promptText = document.getElementById('promptText');
            promptText.select();
            document.execCommand('copy');
            alert('Prompt copiado al portapapeles');
        }

        function abrirEnCopilot() {
            const url = `https://copilot.microsoft.com/`;
            window.open(url, '_blank');
        }

        function abrirEnChatGPT() {
            const url = `https://chat.openai.com/`;
            window.open(url, '_blank');
        }

    </script>
</body>
</html>
